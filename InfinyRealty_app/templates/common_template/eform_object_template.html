{% block page_title %}

{% endblock page_title %}

{% block main_content %}

{% load static %}
{% load custom_template_tags %}

{% endblock main_content %}

{% block custom_js %}
<script>
        var inspType = '{{insptype}}';
        var code = '{{code}}';
        if (status == 1) {
            $("input:checkbox").click(function() { return false; });
            $("input:radio").click(function() { return false; });
        }
        $(".cboSchoolYear").click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            var sdpScrn = objspan.attr("sdpScrn")
            var sdpYear = objspan.attr("sdpYear")
            thiswidth = objspan.width();

            event.preventDefault();
            var combobox = $('<select style="width:100%;width:' + thiswidth + 'px"></select>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}";
                                if (dbName == "focus") formid = formid.substring(0,12)
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    objspan.html( value );
                                    if (value != '') {
                                        schoolID = formid.substring(0,12)
                                        sdpType = sdpScrn
                                        if (fieldName == "developCycleBegin") {
                                            sdpScrn = value.substring(0,4) + "/" + sdpYear.substring(5,7)
                                        } else {
                                            sdpScrn = sdpYear.substring(0,4) + "/" + value.substring(5,7)
                                        }
                                        $.ajax({
                                            url:'{% url 'eForm_update_sdp_response' %}',
                                            type:'POST',
                                            data:{schoolID:schoolID, sdpType:sdpType, sdpScrn:sdpScrn},
                                        })
                                        .done(function(response){
                                        })
                                        .fail(function(xhr, status, error){
                                            $('.modal-message').html(xhr.responseText);
                                        })
                                    }
                                })
                                .fail(function(xhr, status, error){
                                    alert(xhr.responseText);
                                })
                                objspan.show();
                            });
            $(this).hide();
            $(this).after(   combobox.append('<option value=""></option>')
                                     .append('<option value="2010/11">2010/11</option>')
                                     .append('<option value="2011/12">2011/12</option>')
                                     .append('<option value="2012/13">2012/13</option>')
                                     .append('<option value="2013/14">2013/14</option>')
                                     .append('<option value="2014/15">2014/15</option>')
                                     .append('<option value="2015/16">2015/16</option>')
                                     .append('<option value="2016/17">2016/17</option>')
                                     .append('<option value="2017/18">2017/18</option>')
                                     .append('<option value="2018/19">2018/19</option>')
                                     .append('<option value="2019/20">2019/20</option>')
                                     .append('<option value="2020/21">2020/21</option>')
                                     .append('<option value="2021/22">2021/22</option>')
                                     .append('<option value="2022/23">2022/23</option>')
                                     .append('<option value="2023/24">2023/24</option>')
                                     .append('<option value="2024/25">2024/25</option>')
                                     .append('<option value="2025/26">2025/26</option>')
                                     .append('<option value="2026/27">2026/27</option>')
                                     .append('<option value="2027/28">2027/28</option>')
                                     .append('<option value="2028/29">2028/29</option>')
                                     .append('<option value="2029/30">2029/30</option>')
            );
            combobox.val( $.trim($(this).html()) );
            combobox.focus();
        });

        $('.cboRating').click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();

            event.preventDefault();
            var combobox = $('<select style="width:100%;width:' + thiswidth + 'px"></select>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}";
                                if (dbName == "focus") formid = formid.substring(0,12)
                                //alert(dbName);
                                //alert(tableName);
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    if (value == "") value = "&nbsp;";
                                    if (value == "0") value = "--";
                                    if (value == "1") value = "1";
                                    if (value == "2") value = "1+";
                                    if (value == "3") value = "2-";
                                    if (value == "4") value = "2";
                                    if (value == "5") value = "2+";
                                    if (value == "6") value = "3-";
                                    if (value == "7") value = "3";
                                    if (value == "8") value = "3+";
                                    if (value == "9") value = "4";
                                    objspan.html( value );
                                })
                                .fail(function(xhr, status, error){
                                    $('.modal-message').html(xhr.responseText);
                                    //alert(xhr.responseText);
                                })
                                objspan.show();
                            });

            $(this).hide();
            $(this).after(   combobox.append('<option value=""></option>')
                                     .append('<option value="0">--</option>')
                                     .append('<option value="1">1</option>')
                                     .append('<option value="2">1+</option>')
                                     .append('<option value="3">2-</option>')
                                     .append('<option value="4">2</option>')
                                     .append('<option value="5">2+</option>')
                                     .append('<option value="6">3-</option>')
                                     .append('<option value="7">3</option>')
                                     .append('<option value="8">3+</option>')
                                     .append('<option value="9">4</option>')
            );
            if ($(this).html() == "") value = "0";
            if ($(this).html() == "--") value = "0";
            if ($(this).html() == "1") value = "1";
            if ($(this).html() == "1+") value = "2";
            if ($(this).html() == "2-") value = "3";
            if ($(this).html() == "2") value = "4";
            if ($(this).html() == "2+") value = "5";
            if ($(this).html() == "3-") value = "6";
            if ($(this).html() == "3") value = "7";
            if ($(this).html() == "3+") value = "8";
            if ($(this).html() == "4") value = "9";
            combobox.val( value );
            combobox.focus();
        });

        $('.cboMark2').click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();
            event.preventDefault();
            var combobox = $('<select style="width:100%;width:20px"></select>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}";
                                if (dbName == "focus") formid = formid.substring(0,12)
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    if (value == "0") value = "";
                                    if (value == "1") value = "1";
                                    if (value == "2") value = "2";
                                    objspan.html( value );
                                })
                                .fail(function(xhr, status, error){
                                    $('.modal-message').html(xhr.responseText);
                                    //alert(xhr.responseText);
                                })
                                objspan.show();
                            });

            $(this).hide();
            $(this).after(   combobox.append('<option value="0"></option>')
                                     .append('<option value="1">1</option>')
                                     .append('<option value="2">2</option>')
            );
            combobox.val( value );
            combobox.focus();
        });

        $('.cboMark3').click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();
            event.preventDefault();
            var combobox = $('<select style="width:100%;width:20px"></select>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}";
                                if (dbName == "focus") formid = formid.substring(0,12)
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    if (value == "0") value = "";
                                    if (value == "1") value = "1";
                                    if (value == "2") value = "2";
                                    if (value == "3") value = "3";
                                    objspan.html( value );
                                })
                                .fail(function(xhr, status, error){
                                    $('.modal-message').html(xhr.responseText);
                                    //alert(xhr.responseText);
                                })
                                objspan.show();
                            });

            $(this).hide();
            $(this).after(   combobox.append('<option value="0"></option>')
                                     .append('<option value="1">1</option>')
                                     .append('<option value="2">2</option>')
                                     .append('<option value="3">3</option>')
            );
            combobox.val( value );
            combobox.focus();
        });

        $('.cboMark3Text').click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();
            event.preventDefault();
            var combobox = $('<select style="width:100%;width:' + thiswidth + 'px"></select>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}";
                                if (dbName == "focus") formid = formid.substring(0,12)
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    if (value == "") value = "";
                                    if (value == "1") value = "1";
                                    if (value == "2") value = "2";
                                    if (value == "3") value = "3";
                                    objspan.html( value );
                                })
                                .fail(function(xhr, status, error){
                                    $('.modal-message').html(xhr.responseText);
                                    //alert(xhr.responseText);
                                })
                                objspan.show();
                            });

            $(this).hide();
            $(this).after(   combobox.append('<option value=""></option>')
                                     .append('<option value="1">1</option>')
                                     .append('<option value="2">2</option>')
                                     .append('<option value="3">3</option>')
            );
            if ($(this).html() == "") value = "";
            if ($(this).html() == "1") value = "1";
            if ($(this).html() == "2") value = "2";
            if ($(this).html() == "3") value = "3";
            combobox.val( value );
            combobox.focus();
        });

        $('.cboMark4').click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();
            event.preventDefault();
            var combobox = $('<select style="width:100%;width:' + thiswidth + 'px"></select>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}";
                                if (dbName == "focus") formid = formid.substring(0,12)
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    if (value == "0") value = "";
                                    if (value == "1") value = "1";
                                    if (value == "2") value = "2";
                                    if (value == "3") value = "3";
                                    if (value == "4") value = "4";
                                    objspan.html( value );
                                })
                                .fail(function(xhr, status, error){
                                    $('.modal-message').html(xhr.responseText);
                                    //alert(xhr.responseText);
                                })
                                objspan.show();
                            });

            $(this).hide();
            $(this).after(   combobox.append('<option value="0"></option>')
                                     .append('<option value="1">1</option>')
                                     .append('<option value="2">2</option>')
                                     .append('<option value="3">3</option>')
                                     .append('<option value="4">4</option>')

            );
	        if ($(this).html() == "0") value = "";
            if ($(this).html() == "1") value = "1";
            if ($(this).html() == "2") value = "2";
            if ($(this).html() == "3") value = "3";
            if ($(this).html() == "4") value = "4";
            combobox.val( value );
            combobox.focus();
        });

        $('.cboSubject').click(function(){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();
            event.preventDefault();
            var combobox = $('<select style="font-family:tahoma;"></select>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}";
                                if (dbName == "focus") formid = formid.substring(0,12)
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    if (value == "0") value = "&nbsp;&nbsp;&nbsp;&nbsp;";
                                    objspan.html( value );
                                })
                                .fail(function(xhr, status, error){
                                    $('.modal-message').html(xhr.responseText);
                                    //alert(xhr.responseText);
                                })
                                objspan.show();

                            });
                            subcode = "{{subcode}}";
                            var kla = 0;
                            if (subcode == "AR") kla = 1;
                            if (subcode == "C") kla = 2;
                            if (subcode == "E") kla = 3;
                            if (subcode == "MA") kla = 4;
                            if (subcode == "PH") kla = 5;
                            if (subcode == "PE") kla = 6;
                            if (subcode == "SC") kla = 7;
                            if (subcode == "TE") kla = 8;
                            if (subcode == "GS") kla = 9;
                            if (subcode == "LS") kla = 10;
                            $.ajax({
                                url:'{% url 'eForm_klasubject_response' %}',
                                type:'POST',
                                data:{klaid:kla},
                            })
                            .done(function(response){
                                sSubject2List = response;
                                if (sSubject2List != ""){
                                    subject2Arr = sSubject2List.split(";")
                                    var selectval = 0;
                                    for (i=0;i<subject2Arr.length-1;i++)
                                    {
                                        //$(this).hide();
                                        //$(this).after( combobox.append('<option value="'+ subject2Arr[i] + '">'+subject2Arr[i]+'</option>')
                                        //);
                                        if (subject2Arr[i] == value) {
                                            //$(this).after( combobox.append('<option value="'+ subject2Arr[i] + '" selected>'+subject2Arr[i]+'</option>'));
                                            combobox
                                                .append('<option value="'+ subject2Arr[i] + '">'+subject2Arr[i]+'</option>')
                                                .val(subject2Arr[i])
                                                .attr('selected','selected')
                                            ;
                                            selectval = i+1;
                                        } else {
                                            //$(this).after( combobox.append('<option value="'+ subject2Arr[i] + '">'+subject2Arr[i]+'</option>'));
                                            combobox
                                                .append('<option value="'+ subject2Arr[i] + '">'+subject2Arr[i]+'</option>')
                                                .val(subject2Arr[i])
                                            ;
                                        }
                                    }
                                    combobox.prop("selectedIndex", selectval);
                                }
                            })
                            .fail(function(xhr, status, error){
                                // alert the error if any error occured
                                //alert(error.Message);
                                $('#general').html(xhr.responseText);
                                //alert(xhr.responseText);
                            })

            $(this).hide();
            $(this).after( combobox.append('<option value="&nbsp;&nbsp;&nbsp;&nbsp;">&nbsp;&nbsp;&nbsp;&nbsp;</option>')
            );

            if ($(this).html() == "&nbsp;&nbsp;&nbsp;&nbsp;") value = "";
            else
                value = $(this).html();

            combobox.val( value );
            combobox.focus();
        });

        $('.cboArea').click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();

            event.preventDefault();
            var combobox = $('<select style="width:100%;width:' + thiswidth + 'px"></select>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}";
                                if (dbName == "focus") formid = formid.substring(0,12)
                                //alert(dbName);
                                //alert(tableName);
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    objspan.html( value );
                                })
                                .fail(function(xhr, status, error){
                                    $('.modal-message').html(xhr.responseText);
                                    //alert(xhr.responseText);
                                })
                                objspan.show();
                            });

            $(this).hide();
            $(this).after(   combobox.append('<option value=""></option>')
                                     .append('<option value="學校管理">學校管理</option>')
                                     .append('<option value="專業領導">專業領導</option>')
                                     .append('<option value="課程和評估">課程和評估</option>')
                                     .append('<option value="學生學習和教學">學生學習和教學</option>')
                                     .append('<option value="學生支援">學生支援</option>')
                                     .append('<option value="學校夥伴">學校夥伴</option>')
                                     .append('<option value="態度和行為">態度和行為</option>')
                                     .append('<option value="參與和成就">參與和成就</option>')
            );
            if ($(this).html() == "") value = "";
            if ($(this).html() == "學校管理") value = "學校管理";
            if ($(this).html() == "專業領導") value = "專業領導";
            if ($(this).html() == "課程和評估") value = "課程和評估";
            if ($(this).html() == "學生學習和教學") value = "學生學習和教學";
            if ($(this).html() == "學生支援") value = "學生支援";
            if ($(this).html() == "學校夥伴") value = "學校夥伴";
            if ($(this).html() == "態度和行為") value = "態度和行為";
            if ($(this).html() == "參與和成就") value = "參與和成就";
            combobox.val( value );
            combobox.focus();
        });

        $('.cboKeyStage').click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();

            event.preventDefault();
            var combobox = $('<select style="width:100%;width:' + thiswidth + 'px"></select>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}";
                                if (dbName == "focus") formid = formid.substring(0,12)
                                //alert(dbName);
                                //alert(tableName);
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    objspan.html( value );
                                })
                                .fail(function(xhr, status, error){
                                    $('.modal-message').html(xhr.responseText);
                                    //alert(xhr.responseText);
                                })
                                objspan.show();
                            });

            $(this).hide();
            $(this).after(   combobox.append('<option value=""></option>')
                                     .append('<option value="中一">中一</option>')
                                     .append('<option value="中二">中二</option>')
                                     .append('<option value="中三">中三</option>')
                                     .append('<option value="中四">中四</option>')
                                     .append('<option value="中五">中五</option>')
                                     .append('<option value="中六">中六</option>')
            );
            if ($(this).html() == "") value = "";
            if ($(this).html() == "中一") value = "中一";
            if ($(this).html() == "中二") value = "中二";
            if ($(this).html() == "中三") value = "中三";
            if ($(this).html() == "中四") value = "中四";
            if ($(this).html() == "中五") value = "中五";
            if ($(this).html() == "中六") value = "中六";
            combobox.val( value );
            combobox.focus();
        });

        $('.cboGoodPractice').click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();

            event.preventDefault();
            var combobox = $('<select style="width:100%;width:' + thiswidth + 'px"></select>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}";
                                if (dbName == "focus") formid = formid.substring(0,12)
                                //alert(dbName);
                                //alert(tableName);
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    objspan.html( value );
                                })
                                .fail(function(xhr, status, error){
                                    $('.modal-message').html(xhr.responseText);
                                    //alert(xhr.responseText);
                                })
                                objspan.show();
                            });

            $(this).hide();
            $(this).after(   combobox.append('<option value=""></option>')
                                     .append('<option value="值得推介">值得推介</option>')
                                     .append('<option value="須關注的地方">須關注的地方</option>')
            );
            if ($(this).html() == "") value = "";
            if ($(this).html() == "值得推介") value = "值得推介";
            if ($(this).html() == "須關注的地方") value = "須關注的地方";
            combobox.val( value );
            combobox.focus();
        });

        $('.cboClass').click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();

            event.preventDefault();
            var combobox = $('<select style="width:100%;width:' + thiswidth + 'px"></select>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}";
                                if (dbName == "focus") formid = formid.substring(0,12)
                                //alert(dbName);
                                //alert(tableName);
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    objspan.html( value );
                                })
                                .fail(function(xhr, status, error){
                                    $('.modal-message').html(xhr.responseText);
                                    //alert(xhr.responseText);
                                })
                                objspan.show();
                            });

            $(this).hide();
            $(this).after(   combobox.append('<option value="班級/組別數目">班級/組別數目</option>')
                                     .append('<option value="班級">班級</option>')
                                     .append('<option value="組別數目">組別數目</option>')
            );
            if ($(this).html() == "班級/組別數目") value = "班級/組別數目";
            if ($(this).html() == "班級") value = "班級";
            if ($(this).html() == "組別數目") value = "組別數目";
            combobox.val( value );
            combobox.focus();
        });

        $(".txtothers_withwidth").click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();

            event.preventDefault();
            var textarea = $('<input type="text" style="width:100%;width:' + thiswidth + 'px" rows=1></input>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}"
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                    if (value == "") {
                                        objspan.html("");
                                    } else {
                                        objspan.html( value );
                                    }
                                })
                                .fail(function(xhr, status, error){
                                    alert(xhr.responseText);
                                })
                                objspan.show();
                            });

            if ($(this).html() == "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;") {
                textarea.val("");
            }	else {
                textarea.val( $(this).html() );
            }
            $(this).hide();
            $(this).after( textarea );
            textarea.focus();
        });

		$('.txtbox_cal').click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
			var classArray = objspan.attr('class').split(" ");
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();

			event.preventDefault();
			var textarea = $('<input type="text" style="width:100%;" rows=1></input>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}"
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                   objspan.html( value );

                                   if ( classArray[1].substring(0,1) == 'I' ){
                                       var ttl=0;
                                       var i=0
                                       $("." + classArray[1]).each(function(){
                                           if ( ! isNaN(parseInt( $(this).html() )) ){
                                               ttl += parseInt( $(this).html() ) * parseInt( $(this).attr('val') );
                                               i+= parseInt( $(this).html() );
                                           }
                                       });

                                       var ave;
                                       if ( ttl > 0 )
                                           ave = Math.round(ttl/i*100) / 100;
                                       else
                                           ave = 0;

                                       fieldName = classArray[1].substring(1) + '05';
                                       value = ave;
                                       saction = "updatetextfield"
                                       formid = "{{formid}}"
                                       $.ajax({
                                          url:'{% url 'eForm_action_response' %}',
                                          type:'POST',
                                          data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
										  success: function(msg){
											  $(".R" + classArray[1].substring(1)).html(ave);
										  }
                                       })


                                   } // if ( classArray[1].substring(0,1) == 'I' )
                                })
                                .fail(function(xhr, status, error){
                                    alert(xhr.responseText);
                                })
                                objspan.show();
                            });
			$(this).hide();
			$(this).after( textarea );
			textarea.val( $(this).html().replace('&nbsp;', ' ') );
			textarea.focus();
		});

		$('.txtbox_cal_10').click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
			var classArray = objspan.attr('class').split(" ");
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();

			event.preventDefault();
			var textarea = $('<input type="text" style="width:100%;" rows=1></input>')
                            .blur(function(){
                                $(this).hide();
                                value = $(this).val();
                                saction = "updatetextfield"
                                formid = "{{formid}}"
                                $.ajax({
                                    url:'{% url 'eForm_action_response' %}',
                                    type:'POST',
                                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
                                })
                                .done(function(response){
                                   objspan.html( value );

                                   if ( classArray[1].substring(0,1) == 'I' ){
                                       var ttl=0;
                                       var i=0
                                       $("." + classArray[1]).each(function(){
                                           if ( ! isNaN(parseInt( $(this).html() )) ){
                                               ttl += parseInt( $(this).html() ) * 1;
                                               i+= 1;
                                           }
                                       });

                                       var ave;
                                       if ( ttl > 0 )
                                           ave = Math.round(ttl/i*100) / 100;
                                       else
                                           ave = 0;

                                       fieldName = classArray[1].substring(1) + '0K';
                                       value = ave;
                                       saction = "updatetextfield"
                                       formid = "{{formid}}"
                                       $.ajax({
                                          url:'{% url 'eForm_action_response' %}',
                                          type:'POST',
                                          data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
										  success: function(msg){
											  $(".R" + classArray[1].substring(1)).html(ave);
										  }
                                       })


                                   } // if ( classArray[1].substring(0,1) == 'I' )
                                })
                                .fail(function(xhr, status, error){
                                    alert(xhr.responseText);
                                })
                                objspan.show();
                            });
			$(this).hide();
			$(this).after( textarea );
			textarea.val( $(this).html().replace('&nbsp;', ' ') );
			textarea.focus();
		});

        $(".checkBoxSingle").click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();
            if (objspan.prop('checked') == true)
                value = $(this).val();
            else
                value = "0";
            saction = "updatetextfield"
            formid = "{{formid}}"
            $.ajax({
                url:'{% url 'eForm_action_response' %}',
                type:'POST',
                data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
            })
            .done(function(response){
                if(response == "success") {
                    if (value == "false") {
                        objspan.html( "0" );
                    } else {
                        objspan.html( value );
                    }
                } else {
                    alert("Fail to update. Reason:" + response);
                }
            })
            .fail(function(xhr, status, error){
                alert(xhr.responseText);
            })
        });

        $(".checkBoxCross").triSwitch({ loop: true }).click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            var objName = objspan.attr("name");
            thiswidth = objspan.width();
            value = objspan.val();
            if (value == 0)
                value = 1;
            else
                if (value == 1)
                    value = 2;
                else
                    value = 0;
            saction = "updatetextfield"
            formid = "{{formid}}"
            $.ajax({
                url:'{% url 'eForm_action_response' %}',
                type:'POST',
                data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
            })
            .done(function(response){
                if(response != "success") {
                    alert("Fail to update. Reason:" + response);
                }
            })
            .fail(function(xhr, status, error){
                $("#err_message").html(xhr.responseText)
                alert(xhr.responseText);
            })
        });

        var bvalue;
        $(".radGroup").click(function(event){
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            var objName = objspan.attr("name");
            var updateFlag = "0";
            thiswidth = objspan.width();
            saction = "updatetextfield";
            formid = "{{formid}}";
            $("input[name="+objName+"]:radio").each(function(){
                var name = $(this).attr("name");
                var groupFieldName = $(this).attr("fieldName");
                //alert(value+$(this).prop('checked'));
                if ((fieldName == groupFieldName) && (bvalue == $(this).prop('checked'))) {
                    $(this).prop('checked', false)
                    value = "0";
                } else {
                    value = $(this).prop('checked');
                }
                //alert("x"+$(this).prop('checked')+" x "+saction+" x "+dbName+" x "+tableName+" x \n"+fieldName+" x "+groupFieldName+" x "+formid+" x "+value);
                $.ajax({
                    url:'{% url 'eForm_action_response' %}',
                    type:'POST',
                    data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:groupFieldName, value:value, formid:formid, inspType:inspType, code:code},
                })
                .done(function(response){
                    if(response == "success") {
                        if (value == "false") {
                            objspan.html( "0" );
                        } else {
                            objspan.html( value );
                        }
                    } else {
                        alert("Fail to update. Reason:" + response);
                    }
                })
                .fail(function(xhr, status, error){
                    alert(xhr.responseText);
                })
            });
        }).mouseup(function(event){
            bvalue = $(this).prop('checked')
        });

        var bvalue;
        $(".radGroupValue").click(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            thiswidth = objspan.width();

            value = $(this).val();
            saction = "updatetextfield"
            formid = "{{formid}}"
            if (value == bvalue) {
                objspan.prop('checked', false);
                value = "NULL";
            }
            $.ajax({
                url:'{% url 'eForm_action_response' %}',
                type:'POST',
                data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
            })
            .done(function(response){
                if (value == "0") {
                    objspan.html( "0" );
                } else {
                    objspan.html( value );
                }
            })
            .fail(function(xhr, status, error){
                alert(xhr.responseText);
            })
        }).mouseup(function(event){
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            bvalue = $("input[type='radio'][name='"+fieldName+"']:checked").val()
        });

        $(".txtArea").blur(function(event){
            if (status == 1) return false;
            var objspan = $(this);
            var fieldName = objspan.attr("fieldName")
            var tableName = objspan.attr("tableName")
            var dbName = objspan.attr("dbName")
            var placeholder = objspan.attr('placeholder')

            event.preventDefault();
            value = objspan.html();
            saction = "updatetextfield"
            formid = "{{formid}}"
            //alert(fieldName)
            $.ajax({
                url:'{% url 'eForm_action_response' %}',
                type:'POST',
                data:{saction:saction, dbName:dbName, tableName:tableName, fieldName:fieldName, value:value, formid:formid, inspType:inspType, code:code},
            })
            .done(function(response){
                if (value == "") {
                    objspan.html( "" );
                } else {
                    objspan.html( value );
                }
            })
            .fail(function(xhr, status, error){
                $('.modal-message').html(xhr.responseText);
                //alert(xhr.responseText);
            })
        });

        function setwysihtml5(id) {
            var $editor;
            var opts;

            opts = {
                'font-styles': false,
                emphasis: true,
                lists: true,
                html: false,
                image: false,
                link: false,
                'format-code': false,
                events: {
                    load: onload,
                    focus: onfocus,
                    blur: onblur
                }
            };
            $editor = $(id);
            $editor.wysihtml5({
                toolbar: {"size":"xs"},
                showToolbarAfterInit: false,
                 "events": {
                      "focus": function(){
                         this.toolbar.show();
                     },
                      "blur": function() {
                         this.toolbar.hide();
                    }
                }
            });
        }
</script>
{% endblock custom_js %}
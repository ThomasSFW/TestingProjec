{% block page_title %}

{% endblock page_title %}

{% block main_content %}

{% load static %}
{% load custom_template_tags %}

	{% if action == "menutab" %}
        <style>
            .element-class {
              cursor: pointer;
            }
        </style>
		<div class="col-md-12">
			<div class="nav-tabs-custom">
				<ul class="nav nav-tabs nav-primary">
				  <!--<li class="active"><a href="#overview" data-toggle="tabajax" action="overview" year="{{year}}" start_date="{{start_date}}" end_date="{{end_date}}"><b>Overview</b></a></li>-->
				  <li class="nav-item active"><a class="nav-link active" href="#company_view" data-toggle="tabajax" action="company_view" usage="{{usage}}" loginid="{{user_loginid}}" propertyid="{{user_propertyid}}" lock="0"><b>業主公司列表</b></a></li>
				  <!--<li class="nav-item"><a class="nav-link" href="#ctc_view" data-toggle="tabajax" action="ctc_view" usage="{{usage}}" loginid="{{user_loginid}}" propertyid="{{user_propertyid}}" lock="0"><b>業主CTC人士列表</b></a></li>
				  <li class="nav-item"><a class="nav-link" href="#phone_view" data-toggle="tabajax" action="phone_view" usage="{{usage}}" loginid="{{user_loginid}}" propertyid="{{user_propertyid}}" lock="0"><b>業主電話列表</b></a></li>
				  <li class="nav-item"><a class="nav-link" href="#email_view" data-toggle="tabajax" action="email_view" usage="{{usage}}" loginid="{{user_loginid}}" propertyid="{{user_propertyid}}" lock="0"><b>業主電郵列表</b></a></li>-->
				  <li class="nav-item" style="display:none"><a class="nav-link" href="#property_view" id="property_views" data-toggle="tabajax" action="property_view" searchtext="" usage="{{usage}}" loginid="{{user_loginid}} propertyid="{{user_propertyid}}"" propertyid_list=""{% if 1478 not in request.session.accessright %} lock="1"><i class="fa fa-lock"></i>&nbsp;&nbsp;{% else %} lock="0">{% endif %}<b>物業列表</b></a></li>
				  <li class="nav-item"><a class="nav-link" href="#property_edit" id="property_edits" data-toggle="tabajax" action="property_edit" usage="{{usage}}" loginid="{{user_loginid}}" propertyid="{{user_propertyid}}" propertyid_list=""{% if 1476 not in request.session.accessright and 1461 not in request.session.accessright %} lock="1"><i class="fa fa-lock"></i>&nbsp;&nbsp;{% else %} lock="0">{% endif %}<b>新增/編輯物業</b></a></li>
				  <li class="nav-item"><a class="nav-link" href="#property_info" id="property_infos" data-toggle="tabajax" action="property_info" usage="{{usage}}" loginid="{{user_loginid}}" propertyid="{{user_propertyid}}" propertyid_list=""{% if 1478 not in request.session.accessright %} lock="1"><i class="fa fa-lock"></i>&nbsp;&nbsp;{% else %} lock="0">{% endif %}<b>狀況資料</b></a></li>
				  <li class="nav-item"><a class="nav-link" href="#property_oddsheet" id="property_oddsheets" data-toggle="tabajax" action="property_oddsheet" usage="{{usage}}" offertype="{{offertype}}" possession="{{possession}}" loginid="{{user_loginid}}" propertyid="{{user_propertyid}}" propertyid_list=""{% if 1462 not in request.session.accessright %} lock="1"><i class="fa fa-lock"></i>&nbsp;&nbsp;{% else %} lock="0">{% endif %}<b>盤紙(單項)</b></a></li>
				  <li class="nav-item"><a class="nav-link" href="#property_oddsheet_multi" id="property_oddsheets_multi" data-toggle="tabajax" action="property_oddsheet_multi" usage="{{usage}}" loginid="{{user_loginid}}" propertyid="{{user_propertyid}}" propertyid_list=""{% if 1462 not in request.session.accessright %} lock="1"><i class="fa fa-lock"></i>&nbsp;&nbsp;{% else %} lock="0">{% endif %}<b>盤紙列表(多項)</b></a></li>
				  <li class="nav-item"><a class="nav-link" href="#property_offer" id="property_offers" data-toggle="tabajax" action="property_offer" usage="{{usage}}" offertype="{{offertype}}" possession="{{possession}}" loginid="{{user_loginid}}" propertyid="0" propertyid_list=""{% if 1463 not in request.session.accessright %} lock="1"><i class="fa fa-lock"></i>&nbsp;&nbsp;{% else %} lock="0">{% endif %}<b>建立要約</b></a></li>
				  <!--<li class="nav-item"><a class="nav-link" href="#property_contact" id="property_contacts" data-toggle="tabajax" action="property_contact" usage="{{usage}}" loginid="{{user_loginid}}" propertyid="{{user_propertyid}}"{% if 1410 not in request.session.accessright %} lock="1"><i class="fa fa-lock"></i>&nbsp;&nbsp;{% else %} lock="0">{% endif %}<b>聯絡資料</b></a></li>-->
				  <!--<li class="nav-item"><a class="nav-link" href="#property_follow" id="property_follows" data-toggle="tabajax" action="property_follow" usage="{{usage}}" loginid="{{user_loginid}}" propertyid="{{user_propertyid}}"{% if 1410 not in request.session.accessright %} lock="1"><i class="fa fa-lock"></i>&nbsp;&nbsp;{% else %} lock="0">{% endif %}<b>跟進資料</b></a></li>-->
				  <li class="nav-item"><a class="nav-link" href="#request_review" id="request_reviews" data-toggle="tabajax" action="request_review" usage="{{usage}}" loginid="{{user_loginid}}" propertyid="{{user_propertyid}}"{% if 1304 not in request.session.accessright %} lock="1"><i class="fa fa-lock"></i>&nbsp;&nbsp;{% else %} lock="0">{% endif %}<b>審批申請</b></a></li>
                  <!--<li class="nav-item">
                        <div class="input-group">
                            <input type="text" name="q" id="searchinput" class="form-control" placeholder="尋找內容...">
                                <span class="input-group-btn">
									<button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i></button>
                                </span>
						</div>
                  </li>-->
				</ul>
				<div class="tab-content">
					<div class="tab-pane fade show active" id="company_view"></div>
					<div class="tab-pane fade" id="ctc_view"></div>
					<div class="tab-pane fade" id="phone_view"></div>
					<div class="tab-pane fade" id="email_view"></div>
					<div class="tab-pane fade" id="property_view"></div>
					<div class="tab-pane fade" id="property_edit"></div>
					<div class="tab-pane fade" id="property_info"></div>
					<div class="tab-pane fade" id="property_oddsheet"></div>
					<div class="tab-pane fade" id="property_oddsheet_multi"></div>
					<div class="tab-pane fade" id="property_offer"></div>
					<!--<div class="tab-pane fade" id="property_contact"></div>
					<div class="tab-pane fade" id="property_follow"></div>-->
					<div class="tab-pane fade" id="request_review"></div>
				</div>
				<div id="errormessage"></div>
			</div>
		</div>
	{% endif %}

	{% if action == "company_view" %}
        <style>
          .list_property_name { 
            max-height: 65px;
            overflow: hidden;
            position: relative;
            padding-right: 10px;
          }
          .list_property_name.extend {
            max-height: unset;
          }
          .btn_list_extend { 
            position: absolute;
            top: 0px;
            right: 0px;
            cursor:pointer;
           }
        </style>
        <table class="table table-hover" id="contentTable-contact">
            <thead>
                <tr style="text-align:center;background-color:#FFF8DB">
                    <th width="30"></th>
                    <th width="300">公司</th>
                    <th>相關物業</th>
                    <th>業主CTC人</th>
                    <th>業主電話</th>
                    <th>業主電郵</th>
                    <th width="100">物業數量</th>
                    <!--<th width="60">操作</th>-->
                </tr>
            </thead>
            <tbody>
                {% for company_name, property_list in company_list.items %}
                <tr align="top">
                    <td></td>
                    <td valign="top">
                      <a class="show_related_property" contact_type="company" style="cursor:pointer" contact_data="{{ company_name|default_if_none:""|safe }}">
                        <b>{{ company_name|default_if_none:""|safe }}</b>
                      </a>
                    </td>
                    <td valign="top">
                      <div class="list_property_name">
                        {% for property_id, property_name in property_list.items %}
                          {% if 1476 in request.session.accessright or 1461 in request.session.accessright %}
                            <a href="#" class="open_edit" action="edit" formtype="property_info" formname="Property Information" propertyid="{{property_id}}" title="編輯物業">
                              {{property_name}}
                            </a>
                            <br>
                          {% endif %}
                        {% endfor %}
                        {% if property_list|length > 3 %}
                            <div class="btn_list_extend"><i class="fa fa-angle-down"></i></div>
                        {% endif %}
                      </div>
                    </td>
                    <td valign="top">
                      {{ctc_person_list|getDictItem:company_name|join:"<br />"}}
                    </td>
                    <td valign="top">
                      {{contact_info_list|getDictItem:company_name|join:"<br />"}}
                    </td>
                    <td valign="top">
                      {{email_list|getDictItem:company_name|join:"<br />"}}
                    </td>
                    <td align="center" valign="top">{{ property_list|length }}</td>
                    <!--
                    <td valign="top" style="text-align:center;">
                        <ul class="action">
                            <li class="edit"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="edit" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}" email="{{ displaydata.Email|default_if_none:"" }}"><i class="icofont icofont-edit"></i></a></li>
                            <li class="copy"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="add" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}" email="{{ displaydata.Email|default_if_none:"" }}"><i class="icofont icofont-copy"></i></a>&nbsp;</li>
                            <li class="edit"> <a class="show_related_property" contact_type="company" style="cursor:pointer" contact_data="{{ displaydata.Company|default_if_none:""|safe }}"><i class="icofont icofont-link"></i></a></li>
                        </ul>
                    </td>
                    -->
                </tr>
                {% empty %}
                <tr align="top">
                    <td align="center" colspan="11">沒有業主公司記錄</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
	{% endif %}

	{% if action == "ctc_view" %}
        <table class="table table-hover" id="contentTable-contact">
            <thead>
                <tr style="text-align:center;background-color:#FFF8DB">
                    <th width="30"></th>
                    <th width="300">CTC人仕</th>
                    <th>相關物業</th>
                    <th width="100">物業數量</th>
                    <!--<th width="60">操作</th>-->
                </tr>
            </thead>
            <tbody>
                {% for displaydata in ctc_person_list %}
                <tr align="top">
                    <td></td>
                    <td valign="top"><a class="show_related_property" contact_type="company" style="cursor:pointer" contact_data="{{ displaydata.CompanyName|default_if_none:""|safe }}"><b>{{ displaydata.Person|default_if_none:""|safe }}</b></a></td>
                    <td valign="top">
                        {% for displayproperty in displaydata.PropertyIDs|default_if_none:""|split:", " %}
                            {% if 1476 in request.session.accessright or 1461 in request.session.accessright %}<a href="#" class="open_edit" action="edit" formtype="property_info" formname="Property Information" propertyid="{{displayproperty}}" propertyno="{{ displaydata.PropertyNo }}" propertyname="{{ displaydata.PropertyName }}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floorzone="{{ displaydata.FloorZone }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}" tenant="{{ displaydata.tenant }}" currentrent="{{ displaydata.currentrent }}" rentalperiod="{{ displaydata.RentalPeriod }}" rentalstartdate="{{ displaydata.rentalstartdate }}" formerowner="{{ displaydata.formerowner }}" finalprice="{{ displaydata.finalprice }}" transactiondate="{{ displaydata.transactiondate }}" title="編輯物業">{{displayproperty|in_property}}</a><br>{% endif %}
                        {% endfor %}
                    </td>
                    <td align="center" valign="top">{{ displaydata.ContactCount|default_if_none:"0"|safe }}</td>
                    <!--
                    <td valign="top" style="text-align:center;">
                        <ul class="action">
                            <li class="edit"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="edit" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}" email="{{ displaydata.Email|default_if_none:"" }}"><i class="icofont icofont-edit"></i></a></li>
                            <li class="copy"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="add" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}" email="{{ displaydata.Email|default_if_none:"" }}"><i class="icofont icofont-copy"></i></a>&nbsp;</li>
                            <li class="edit"> <a class="show_related_property" contact_type="company" style="cursor:pointer" contact_data="{{ displaydata.Company|default_if_none:""|safe }}"><i class="icofont icofont-link"></i></a></li>
                        </ul>
                    </td>
                    -->
                </tr>
                {% empty %}
                <tr align="top">
                    <td align="center" colspan="11">沒有業主CTC人仕記錄</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
	{% endif %}

	{% if action == "phone_view" %}
        <table class="table table-hover" id="contentTable-contact">
            <thead>
                <tr style="text-align:center;background-color:#FFF8DB">
                    <th width="30"></th>
                    <th width="130">電話</th>
                    <th>相關物業</th>
                    <th width="100">物業數量</th>
                    <!--<th width="60">操作</th>-->
                </tr>
            </thead>
            <tbody>
                {% for displaydata in phone_list %}
                <tr align="top">
                    <td></td>
                    <td valign="top"><a class="show_related_property" contact_type="company" style="cursor:pointer" contact_data="{{ displaydata.CompanyName|default_if_none:""|safe }}"><b>{{ displaydata.Phone|default_if_none:""|safe }}</b></a></td>
                    <td valign="top">
                        {% for displayproperty in displaydata.PropertyIDs|default_if_none:""|split:", " %}
                            {% if 1476 in request.session.accessright or 1461 in request.session.accessright %}<a href="#" class="open_edit" action="edit" formtype="property_info" formname="Property Information" propertyid="{{displayproperty}}" propertyno="{{ displaydata.PropertyNo }}" propertyname="{{ displaydata.PropertyName }}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floorzone="{{ displaydata.FloorZone }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}" tenant="{{ displaydata.tenant }}" currentrent="{{ displaydata.currentrent }}" rentalperiod="{{ displaydata.RentalPeriod }}" rentalstartdate="{{ displaydata.rentalstartdate }}" formerowner="{{ displaydata.formerowner }}" finalprice="{{ displaydata.finalprice }}" transactiondate="{{ displaydata.transactiondate }}" title="編輯物業">{{displayproperty|in_property}}</a><br>{% endif %}
                        {% endfor %}
                    </td>
                    <td align="center" valign="top">{{ displaydata.ContactCount|default_if_none:"0"|safe }}</td>
                    <!--
                    <td valign="top" style="text-align:center;">
                        <ul class="action">
                            <li class="edit"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="edit" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}" email="{{ displaydata.Email|default_if_none:"" }}"><i class="icofont icofont-edit"></i></a></li>
                            <li class="copy"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="add" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}" email="{{ displaydata.Email|default_if_none:"" }}"><i class="icofont icofont-copy"></i></a>&nbsp;</li>
                            <li class="edit"> <a class="show_related_property" contact_type="company" style="cursor:pointer" contact_data="{{ displaydata.Company|default_if_none:""|safe }}"><i class="icofont icofont-link"></i></a></li>
                        </ul>
                    </td>
                    -->
                </tr>
                {% empty %}
                <tr align="top">
                    <td align="center" colspan="11">沒有業主電話記錄</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
	{% endif %}

	{% if action == "email_view" %}
        <table class="table table-hover" id="contentTable-contact">
            <thead>
                <tr style="text-align:center;background-color:#FFF8DB">
                    <th width="30"></th>
                    <th width="300">電郵</th>
                    <th>相關物業</th>
                    <th width="100">物業數量</th>
                    <!--<th width="60">操作</th>-->
                </tr>
            </thead>
            <tbody>
                {% for displaydata in email_list %}
                <tr align="top">
                    <td></td>
                    <td valign="top"><a class="show_related_property" contact_type="company" style="cursor:pointer" contact_data="{{ displaydata.CompanyName|default_if_none:""|safe }}"><b>{{ displaydata.Email|default_if_none:""|safe }}</b></a></td>
                    <td valign="top">
                        {% for displayproperty in displaydata.PropertyIDs|default_if_none:""|split:", " %}
                            {% if 1476 in request.session.accessright or 1461 in request.session.accessright %}<a href="#" class="open_edit" action="edit" formtype="property_info" formname="Property Information" propertyid="{{displayproperty}}" propertyno="{{ displaydata.PropertyNo }}" propertyname="{{ displaydata.PropertyName }}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floorzone="{{ displaydata.FloorZone }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}" tenant="{{ displaydata.tenant }}" currentrent="{{ displaydata.currentrent }}" rentalperiod="{{ displaydata.RentalPeriod }}" rentalstartdate="{{ displaydata.rentalstartdate }}" formerowner="{{ displaydata.formerowner }}" finalprice="{{ displaydata.finalprice }}" transactiondate="{{ displaydata.transactiondate }}" title="編輯物業">{{displayproperty|in_property}}</a><br>{% endif %}
                        {% endfor %}
                    </td>
                    <td align="center" valign="top">{{ displaydata.ContactCount|default_if_none:"0"|safe }}</td>
                    <!--
                    <td valign="top" style="text-align:center;">
                        <ul class="action">
                            <li class="edit"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="edit" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}" email="{{ displaydata.Email|default_if_none:"" }}"><i class="icofont icofont-edit"></i></a></li>
                            <li class="copy"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="add" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}" email="{{ displaydata.Email|default_if_none:"" }}"><i class="icofont icofont-copy"></i></a>&nbsp;</li>
                            <li class="edit"> <a class="show_related_property" contact_type="company" style="cursor:pointer" contact_data="{{ displaydata.Company|default_if_none:""|safe }}"><i class="icofont icofont-link"></i></a></li>
                        </ul>
                    </td>
                    -->
                </tr>
                {% empty %}
                <tr align="top">
                    <td align="center" colspan="11">沒有業主電郵記錄</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
	{% endif %}

	{% if action == "usage_view" %}
        <br>
		<div class="row">

          <div class="col-lg-2 col-md-6 col-sm-6">
            <div class="card sale-chart">
              <div class="card-body">
                <div class="d-flex">
                  <div class="flex-shrink-0">
                    <div class="sale-detail">
                      <div class="icon">
                          <a href="#" class="open_view"><h3>#</h3></a>
                      </div>
                      <div class="sale-content">
                        <h3>
                            <a href="#" class="open_view">物業編號</a>
                        </h3>
                        <input type="text" name="sq" id="searchpropertyno" class="form-control" placeholder="S-0001" maxlength="10" size="6">
                      </div>
                    </div>
                  </div>
                  <div class="small-chart-view sales-chart" id="sales-chart"></div>
                </div>
              </div>
            </div>
          </div>

        {% for displaydata in usage_view_list %}
          <div class="col-lg-2 col-md-6 col-sm-6">
            <div class="card sale-chart">
              <div class="card-body">
                <div class="d-flex">
                  <div class="flex-shrink-0">
                    <div class="sale-detail">
                      <div class="icon">
                          {% if displaydata.Usage == "住宅" %}
                            <a href="#" class="open_view" usage="住宅"><i class="icofont icofont-building-alt fa-2x"></i></a>
                          {% elif displaydata.Usage == "商業" %}
                            <a href="#" class="open_view" usage="商業"><i class="icofont icofont-bank-alt fa-2x"></i></a>
                          {% elif displaydata.Usage == "商舖" %}
                            <a href="#" class="open_view" usage="商舖"><i class="icofont icofont-briefcase-alt-2 fa-2x"></i></a>
                          {% elif displaydata.Usage == "工業" %}
                            <a href="#" class="open_view" usage="工業"><i class="icon-server fa-2x"></i></a>
                          {% elif displaydata.Usage == "車位" %}
                            <a href="#" class="open_view" usage="車位"><i class="icon-car fa-2x"></i></a>
                          {% else %}
                            <a href="#" class="open_view" usage="全部"><i class="icon-face-smile fa-2x"></i></a>
                          {% endif %}
                      </div>
                      <div class="sale-content">
                        <h3>
                            {% if displaydata.Usage is None %}
                                <a href="#" class="open_view" usage="全部">全部</a>
                            {% else %}
                                <a href="#" class="open_view" usage="{{displaydata.Usage}}">{{displaydata.Usage}}</a>
                            {% endif %}
                        </h3>
                        <h2>{{displaydata.UsageCount}}</h2>
                      </div>
                    </div>
                  </div>
                  <div class="small-chart-view sales-chart" id="sales-chart"></div>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
		</div>
    {% endif %}

	{% if action == "property_view" %}
        <div class="row g-3">
            <div class="col-md-2">
                <div class="input-group">
                    <input type="text" name="q" id="searchinput" class="form-control" placeholder="尋找內容/業主或公司名稱/電話...">
                </div>
            </div>
            <div class="col-md-2">
                <select id="cboUsage1" class="form-select">
                <option value="" {% if user_usage == "" %}selected{% endif %}>- 所有用途 -</option>
                {% for usages in usage_list %}
                    <option value="{{usages.usage_name}}" {% if user_usage == usages.usage_name %}selected{% endif %}>{{usages.usage_name}}</option>
                {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select id="cboOfferType" class="form-select">
                <option value="" {% if user_offer == "" %}selected{% endif %}>- 所有盤類 -</option>
                {% for offertype in offertype_list %}
                    <option value="{{offertype.code_detail_name}}" {% if user_offertype == offertype.code_detail_name %}selected{% endif %}>{{offertype.code_detail_name}}</option>
                {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select id="cboPossession" class="form-select">
                <option value="" {% if user_offer == "" %}selected{% endif %}>- 所有物業狀況 -</option>
                {% for possession in possession_list %}
                    <option value="{{possession.code_detail_name}}" {% if user_possession == possession.code_detail_name %}selected{% endif %}>{{possession.code_detail_name}}</option>
                {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
            </div>
            <div class="col-md-2">
                <select id="cboArea" class="form-select">
                <option value="" {% if user_area == "" %}selected{% endif %}>- 所有地區 -</option>
                {% for area in area_list %}
                    <option value="{{area.code_detail_name}}" {% if user_area == area.code_detail_name %}selected{% endif %}>{{area.code_detail_name}}</option>
                {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select id="cboSubDistrict" class="form-select">
                <option value="" {% if user_subdistrict == "" %}selected{% endif %}>- 所有分區 -</option>
                {% for subdistrict in subdistrict_list|dictsort:"SubDistrict"|dictsort:"District" %}
                    <option value="{{subdistrict.SubDistrict}}" {% if user_subdistrict == subdistrict.SubDistrict %}selected{% endif %} area="{{subdistrict.District}}">{{subdistrict.District}} - {{subdistrict.SubDistrict}}</option>
                {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select id="cboStreet" class="form-select">
                <option value="" {% if user_street == "" %}selected{% endif %}>- 所有街道 -</option>
                {% for street in street_list %}
                    <option value="{{street.Street}}" {% if user_street == street.Street %}selected{% endif %}>{{street.Street}}</option>
                {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <select id="cboBuilding" class="form-select">
                <option value="" {% if user_building == "" %}selected{% endif %}>- 所有大廈 -</option>
                {% for building in building_list %}
                    <option value="{{building.Building}}" {% if user_building == building.Building %}selected{% endif %}>{{building.Building}}</option>
                {% endfor %}
                </select>
            </div>
        </div>
        <div class="table-responsive">
            <table class="display" id="contentTable" data-page-length="15">
                <thead>
                    <tr style="text-align:center;" class="bg-success">
                        <th width="20"></th>
                        <th width="60">物業編號</th>
                        <th width="50">用途</th>
                        <th width="200">地址</th>
                        <th width="60">建築面積</th>
                        <th width="60">實用面積</th>
                        <th width="60">盤類</th>
                        <th style="text-align:center;" width="50">業主叫價</th>
                        <!--<th style="text-align:center;" width="70">呎價</th>-->
                        <th style="text-align:center;" width="50">業主叫租</th>
                        <!--<th style="text-align:center;" width="70">呎租</th>-->
                        <th style="text-align:center;" width="50">管理費</th>
                        <th style="text-align:center;" width="50">差餉</th>
                        <th style="text-align:center;" width="60">物業狀況</th>
                        <th style="text-align:center;" width="50">現租金</th>
                        <th style="text-align:center;" width="50">租期</th>
                        <th style="text-align:center;" width="50">回報率</th>
                        <th style="text-align:center;" width="40">圖</th>
                        <th style="text-align:center;" width="110">更新日期</th>
                        <th width="60">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for displaydata in property_view_list %}
                    <tr valign="top">
                        <td data-filter="{{ displaydata.PropertyID }}">{{ displaydata.PropertyID }}</td>
                        <td data-filter="{{ displaydata.PropertyNo }}">{{ displaydata.PropertyNo }}</td>
                        <td style="text-align:center;" data-filter="{{ displaydata.Usage }}">{{ displaydata.Usage }}</td>
                        <td data-filter="{{ displaydata.PropertyName }}">{{ displaydata.PropertyName }}{% if displaydata.FloorZone|default_if_none:"" != "" %}<font color="red">({{ displaydata.FloorZone|default_if_none:"" }})</font>{% endif %}</td>
                        <td style="text-align:right;">{{ displaydata.GrossArea|default_if_none:""|format_number_with_commas }}</td>
                        <td style="text-align:right;">{{ displaydata.NetArea|default_if_none:""|format_number_with_commas }}</td>
                        <td style="text-align:center;" data-filter="{{ displaydata.OfferType }}">{{ displaydata.OfferType }}</td>
                        <td style="text-align:right;">{{ displaydata.SellingPrice|format_numeric }}</td>
                        <!--<td style="text-align:center;">{{ displaydata.UnitPrice }}</td>-->
                        <td style="text-align:right;">{{ displaydata.Rent|format_numeric }}</td>
                        <!--<td style="text-align:center;">{{ displaydata.UnitRent }}</td>-->
                        <td style="text-align:right;">{{ displaydata.ManagementFee|format_numeric }}</td>
                        <td style="text-align:right;">{{ displaydata.Rates|format_numeric }}</td>
                        <td style="text-align:center;" data-filter="{{ displaydata.Possession }}">
                            {% if displaydata.Possession == "現吉" %}<span class="badge badge-success text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "商議" %}<span class="badge badge-warning text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "連租約" %}<span class="badge badge-danger text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "已售" %}<span class="badge badge-success text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "已租" %}<span class="badge badge-primary text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "封盤" %}<span class="badge badge-primary text-md">{{displaydata.Possession}}</span>{% endif %}
                        </td>
                        <td style="text-align:right;">{{ displaydata.CurrentRent|default_if_none:"" }}</td>
                        <td style="text-align:right;">{{ displaydata.RentalPeriod|default_if_none:"" }}</td>
                        <td style="text-align:right;">{{ displaydata.Yield|default_if_none:"" }}</td>
                        <td style="text-align:center;" data-filter="{{ displaydata.ContactInfoString }}">
                           {% if displaydata.FileName is not NULL %}
                                <img src="/static/dist/img-web/property-cms/{{displaydata.PropertyID}}/{{displaydata.FileName}}" width="60">
                                <!--<span class="badge badge-success text-md">O</span>-->
                           {% endif %}
                        </td>
                        <td style="text-align:center;">{{ displaydata.ModifyDate|date:'Y/m/d H:i' }}</td>
                        <td style="text-align:center;">
                            <ul class="action">
                                {% if 1476 in request.session.accessright or 1461 in request.session.accessright %}<li class="edit"> <a href="#" class="open_edit" action="edit" formtype="property_info" formname="Property Information" propertyid="{{ displaydata.PropertyID }}" propertyno="{{ displaydata.PropertyNo }}" propertyname="{{ displaydata.PropertyName }}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floorzone="{{ displaydata.FloorZone }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}" tenant="{{ displaydata.tenant }}" currentrent="{{ displaydata.currentrent }}" rentalperiod="{{ displaydata.RentalPeriod }}" rentalstartdate="{{ displaydata.rentalstartdate }}" formerowner="{{ displaydata.formerowner }}" finalprice="{{ displaydata.finalprice }}" transactiondate="{{ displaydata.transactiondate }}" title="編輯物業"><i class="icofont icofont-ui-edit"></i></a></li>{% endif %}
                                {% if 1464 in request.session.accessright %}<li class="edit"> <a href="#" class="open_modal_picture" action="upload" data-bs-toggle="modal" data-original-title="test" data-bs-target="#PictureModal" formtype="property_info" formname="Property Information" propertyid="{{ displaydata.PropertyID }}" propertyno="{{ displaydata.PropertyNo }}" propertyname="{{ displaydata.PropertyName }}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floorzone="{{ displaydata.FloorZone }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}" tenant="{{ displaydata.tenant }}" currentrent="{{ displaydata.currentrent }}" rentalperiod="{{ displaydata.RentalPeriod }}" rentalstartdate="{{ displaydata.rentalstartdate }}" formerowner="{{ displaydata.formerowner }}" finalprice="{{ displaydata.finalprice }}" transactiondate="{{ displaydata.transactiondate }}" filetype="photo" title="上載圖片"><i class="icofont icofont-upload-alt"></i></a></li>{% endif %}
                                {% if 1462 in request.session.accessright %}<li class="edit"> <a href="#" class="open_oddsheet" action="oddsheet" formtype="property_info" formname="Property Information" propertyid="{{ displaydata.PropertyID }}" propertyno="{{ displaydata.PropertyNo }}" propertyname="{{ displaydata.PropertyName }}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floorzone="{{ displaydata.FloorZone }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}" tenant="{{ displaydata.tenant }}" currentrent="{{ displaydata.currentrent }}" rentalperiod="{{ displaydata.RentalPeriod }}" rentalstartdate="{{ displaydata.rentalstartdate }}" formerowner="{{ displaydata.formerowner }}" finalprice="{{ displaydata.finalprice }}" transactiondate="{{ displaydata.transactiondate }}" title="建立盤紙"><i class="icofont icofont-ui-contact-list"></i></a></li>{% endif %}
                                {% if 1463 in request.session.accessright %}<li class="edit"> <a href="#" class="open_offer" action="offer" formtype="property_info" formname="Property Information" propertyid="{{ displaydata.PropertyID }}" propertyno="{{ displaydata.PropertyNo }}" propertyname="{{ displaydata.PropertyName }}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floorzone="{{ displaydata.FloorZone }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}" tenant="{{ displaydata.tenant }}" currentrent="{{ displaydata.currentrent }}" rentalperiod="{{ displaydata.RentalPeriod }}" rentalstartdate="{{ displaydata.rentalstartdate }}" formerowner="{{ displaydata.formerowner }}" finalprice="{{ displaydata.finalprice }}" transactiondate="{{ displaydata.transactiondate }}" title="建立要約"><i class="icofont icofont-file-alt"></i></a></li>{% endif %}
                            </ul>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

	{% if action == "property_edit" %}
        <p style="padding-left:160px">
        {% if propertyid != 0 %}
            <h3 class="mt-4" style="font-weight:600;padding-left:20px">編輯物業 - {{property_list.0.propertyname}}</h3>
        {% else %}
            <h3 class="mt-4" style="font-weight:600;padding-left:20px">新增物業</h3>
        {% endif %}
        </p>
      <!-- Container-fluid starts-->

      <div class="container-fluid add-product" id="editTable">
        <div class="row">
          <div class="col-lg-6">
            <div class="card">
              <div class="card-body">
                <div class="product-info">
                  <h3 class="mt-4" style="font-weight:600">物業資料</h3>
                  <form>
                    <input type="hidden" id="propertyid" value="{{property_list.0.propertyid}}">
                    <input type="hidden" id="propertyid2" value="{{property_list.0.propertyid}}">
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-5">
                          <div class="mb-3">
                            <label class="form-label">用途</label>
                            <select class="form-select" id="usage"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}>
                            {% for usage in usage_list %}
                                <option value="{{usage.usage_name}}"{%if usage.usage_name == property_list.0.usage %} selected{% endif %}>{{usage.usage_name}}</option>
                            {% endfor %}
                            </select>
                          </div>
                        </div>
                        <div class="col-sm-7">
                          <div class="mb-3">
                            <label class="form-label">物業編號 <font color="red"></font></label>
                            <input class="form-control" placeholder="物業編號必須填寫" type="text" id="propertyno" value="{{property_list.0.propertyno}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-12">
                          <div class="mb-3">
                            <label class="form-label">物業名稱 <font color="red">(自動生成)</font></label>
                            <input class="form-control" placeholder="如漏空，以下地址資料會自動填上" type="text" id="propertyname" value="{{property_list.0.propertyname}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>

                  <h3 class="mt-4" style="font-weight:600">地址</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">地區</label>
                            <input class="form-control" placeholder="" type="text" id="district" list="districts" value="{{property_list.0.district}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                            <datalist id="districts">
                            {% for district in district_list %}
                                <option value="{{district.code_detail_name}}"{%if district.code_detail_name == property_list.0.district %} selected{% endif %}>{{district.code_detail_name}}</option>
                            {% endfor %}
                            </datalist>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">分區</label>
                            <input class="form-control" placeholder="" type="text" id="subdistrict" list="subdistricts" value="{{property_list.0.subdistrict}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                            <datalist id="subdistricts">
                            {% for subdistrict in subdistrict_list %}
                                <option value="{{subdistrict.code_detail_name}}"{%if subdistrict.code_detail_name == property_list.0.subdistrict %} selected{% endif %}>{{subdistrict.code_detail_name}}</option>
                            {% endfor %}
                            </datalist>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-4">
                          <div class="mb-3">
                            <label class="form-label">街道</label>
                            <input class="form-control" placeholder="" type="text" id="street" list="streets" value="{{property_list.0.street}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                            <datalist id="streets">
                            {% for street in street_list %}
                                <option value="{{street.code_detail_name}}"{%if street.code_detail_name == property_list.0.street %} selected{% endif %}>{{street.code_detail_name}}</option>
                            {% endfor %}
                            </datalist>
                          </div>
                        </div>
                        <div class="col-sm-4">
                          <div class="mb-3">
                            <label class="form-label">街號</label>
                            <input class="form-control" placeholder="" type="text" id="streetno" value="{{property_list.0.streetno}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-4">
                          <div class="mb-3">
                            <label class="form-label">大廈</label>
                            <input class="form-control" placeholder="" type="text" id="building" list="buildings" value="{{property_list.0.building}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                            <datalist id="buildings">
                            {% for building in building_list %}
                                <option value="{{building.building}}"{%if building.building == property_list.0.building %} selected{% endif %}>{{building.building}}</option>
                            {% endfor %}
                            </datalist>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-4">
                          <div class="mb-3">
                            <label class="form-label">樓層區域<font color="red">(只顯示在網頁上)</font></label>
                            <select class="form-select" id="floorzone"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}>
                                <option value=""{%if property_list.0.floorzone == "" %} selected{% endif %}>沒有指定</option>
                            {% for floorzone in floorzone_list %}
                                <option value="{{floorzone.code_detail_name}}"{%if floorzone.code_detail_name == property_list.0.floorzone %} selected{% endif %}>{{floorzone.code_detail_name}}</option>
                            {% endfor %}
                            </select>
                          </div>
                        </div>
                        <div class="col-sm-4">
                          <div class="mb-3">
                            <label class="form-label">樓層</label>
                            <input class="form-control" placeholder="" type="text" id="floor" value="{{property_list.0.floor}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-4">
                          <div class="mb-3">
                            <label class="form-label">單位</label>
                            <input class="form-control" placeholder="" type="text" id="unit" value="{{property_list.0.unit}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>

                  <h3 class="mt-4" style="font-weight:600">圖片({{property_file_list|length}}) {% if 1464 in request.session.accessright %}<button type="button" class="btn btn-xs btn-success me-3 open_modal_picture" id="add_picture_button" data-bs-toggle="modal" data-original-title="test" data-bs-target="#PictureModal" action="upload" filetype="photo" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" propertyno="{{property_list.0.propertyno}}" propertyname="{{property_list.0.propertyname}}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}"><i class="fa fa-plus"></i> 加入</button>{% endif %}</h3>
                  <form>
                    <div class="product-group">
                      <!--
                      <div class="owl-carousel owl-theme" id="owl-carousel-15">
                        {% for displayfile in property_file_list %}
                            <div class="item"><img src="/static/dist/img-web/property-cms/{{displayfile.propertyid}}/{{displayfile.filename}}" alt="">
                                <button type="button" class="btn btn-xs btn-primary">圖片#{{forloop.counter}}</button>&nbsp;
                                <button type="button" class="btn btn-xs btn-danger delete_picture" id="delete_picture_button" action="delete_picture" formtype="property_info" formname="Property Information" pictureid="{{forloop.counter}}" fileid="{{displayfile.fileid}}"><i class="fa fa-close"></i> 刪除</button>&nbsp;
                                {% if displayfile.ismain == 1 %}
                                <button type="button" class="btn btn-xs btn-success main_picture" id="main_picture_button" action="main_picture" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displayfile.fileid}}"><i class="fa fa-home"></i> 封面</button>
                                {% else %}
                                <button type="button" class="btn btn-xs btn-light main_picture" id="main_picture_button" action="main_picture" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displayfile.fileid}}"><i class="fa fa-home"></i> 封面</button>
                                {% endif %}
                            </div>
                        {% empty %}
                            <center>暫時未有圖片</center>
                        {% endfor %}
                      </div>
                      -->
                      <div class="gallery my-gallery card-body row" itemscope="">
                        {% for displayfile in property_file_list %}
                            <figure class="col-xl-4 col-md-4 col-sm-4 xl-25 box-col-25" itemprop="associatedMedia" itemscope="">
                              {% setvar "/static/dist/img-web/property-cms/"|addtext:displayfile.propertyid|addtext:"/"|addtext:displayfile.filename as property_image %}
                                <a href="{{property_image}}" itemprop="contentUrl" data-size="1600x950">
                                  {% if ".mp4" in displayfile.filename %}
                                      <video width="100%" height="100%" controls>
                                        <source src="{{property_image}}" type="video/mp4">
                                        Your browser does not support the video tag.
                                      </video>
                                  {% else %}
                                    <img class="img-thumbnail" src="{{property_image}}" itemprop="thumbnail" alt="Image description">
                                  {% endif %}
                                </a>
                                {% if displayfile.isapprove == 1 %}
                                <button type="button" class="btn btn-xs btn-primary approve_picture" id="approve_picture_button" action="approve_picture" approve="0" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displayfile.fileid}}">圖片#{{forloop.counter}}</button>&nbsp;
                                {% else %}
                                <button type="button" class="btn btn-xs btn-light approve_picture" id="main_picture_button" action="approve_picture" approve="1" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displayfile.fileid}}">圖片#{{forloop.counter}}</button>
                                {% endif %}
                                <button type="button" class="btn btn-xs btn-danger delete_picture" id="delete_picture_button" action="delete_picture" formtype="property_info" formname="Property Information" pictureid="{{forloop.counter}}" fileid="{{displayfile.fileid}}"><i class="fa fa-close"></i> 刪除</button>&nbsp;
                                {% if displayfile.ismain == 1 %}
                                <button type="button" class="btn btn-xs btn-success main_picture" id="main_picture_button" action="main_picture" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displayfile.fileid}}"><i class="fa fa-home"></i> 封面</button>
                                {% else %}
                                <button type="button" class="btn btn-xs btn-light main_picture" id="main_picture_button" action="main_picture" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displayfile.fileid}}"><i class="fa fa-home"></i> 封面</button>
                                {% endif %}
                              <figcaption itemprop="caption description">圖片#{{forloop.counter}}</figcaption>
                            </figure>
                        {% empty %}
                            <center>暫時未有圖片</center>
                        {% endfor %}
                      </div>
                    </div>
                  </form>
                  <h3 class="mt-4" style="font-weight:600">平面圖({{property_floorplan_list|length}}) {% if 1464 in request.session.accessright %}<button type="button" class="btn btn-xs btn-success me-3 open_modal_picture" id="add_picture_button" data-bs-toggle="modal" data-original-title="test" data-bs-target="#PictureModal" action="upload" filetype="floorplan" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" propertyno="{{property_list.0.propertyno}}" propertyname="{{property_list.0.propertyname}}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}"><i class="fa fa-plus"></i> 加入</button>{% endif %}</h3>
                  <form>
                    <div class="product-group">
                      <div class="gallery my-gallery card-body row" itemscope="">
                        {% for displayfloorplan in property_floorplan_list %}
                            <figure class="col-xl-4 col-md-4 col-sm-4 xl-25 box-col-25" itemprop="associatedMedia" itemscope="">
                                <a href="/static/dist/img-web/floorplan-cms/{{displayfloorplan.propertyid}}/{{displayfloorplan.filename}}" itemprop="contentUrl" data-size="1600x950"><img class="img-thumbnail" src="/static/dist/img-web/floorplan-cms/{{displayfloorplan.propertyid}}/{{displayfloorplan.filename}}" itemprop="thumbnail" alt="Image description">
                                </a>
                                {% if displayfloorplan.isapprove == 1 %}
                                <button type="button" class="btn btn-xs btn-primary approve_picture" id="approve_picture_button" action="approve_picture" approve="0" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displayfloorplan.fileid}}">平面圖#{{forloop.counter}}</button>&nbsp;
                                {% else %}
                                <button type="button" class="btn btn-xs btn-light approve_picture" id="approve_picture_button" action="approve_picture" approve="1" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displayfloorplan.fileid}}">平面圖#{{forloop.counter}}</button>
                                {% endif %}
                                <button type="button" class="btn btn-xs btn-danger delete_picture" id="delete_picture_button" action="delete_picture" formtype="property_info" formname="Property Information" pictureid="{{forloop.counter}}" fileid="{{displayfloorplan.fileid}}"><i class="fa fa-close"></i> 刪除</button>&nbsp;
                                {% if displayfloorplan.ismain == 1 %}
                                <button type="button" class="btn btn-xs btn-success main_picture" id="main_picture_button" action="main_picture" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displayfloorplan.fileid}}"><i class="fa fa-home"></i> 封面</button>
                                {% else %}
                                <button type="button" class="btn btn-xs btn-light main_picture" id="main_picture_button" action="main_picture" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displayfloorplan.fileid}}"><i class="fa fa-home"></i> 封面</button>
                                {% endif %}
                              <figcaption itemprop="caption description">平面圖#{{forloop.counter}}</figcaption>
                            </figure>
                        {% empty %}
                            <center>暫時未有平面圖</center>
                        {% endfor %}
                      </div>
                    </div>
                  </form>
                  <h3 class="mt-4" style="font-weight:600">相關文件({{property_document_list|length}}) {% if 1464 in request.session.accessright %}<button type="button" class="btn btn-xs btn-success me-3 open_modal_picture" id="add_picture_button" data-bs-toggle="modal" data-original-title="test" data-bs-target="#PictureModal" action="upload" filetype="document" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" propertyno="{{property_list.0.propertyno}}" propertyname="{{property_list.0.propertyname}}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}"><i class="fa fa-plus"></i> 加入</button>{% endif %}</h3>
                  <form>
                    <div class="product-group">
                      <div class="owl-carousel owl-theme" id="owl-carousel-13">
                        {% for displaydocument in property_document_list %}
                          <div class="item"><a href="/static/dist/img-web/document-cms/{{displaydocument.propertyid}}/{{displaydocument.filename}}" target="_new_file">{{displaydocument.filename}}</a>
                                {% if displaydocument.isapprove == 1 %}
                                <button type="button" class="btn btn-xs btn-primary approve_picture" id="approve_picture_button" action="approve_picture" approve="0" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displaydocument.fileid}}">文件#{{forloop.counter}}</button>&nbsp;
                                {% else %}
                                <button type="button" class="btn btn-xs btn-light approve_picture" id="approve_picture_button" action="approve_picture" approve="1" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displaydocument.fileid}}">文件#{{forloop.counter}}</button>
                                {% endif %}
                                <button type="button" class="btn btn-xs btn-danger delete_picture" id="delete_picture_button" action="delete_picture" formtype="property_info" formname="Property Information" pictureid="{{forloop.counter}}" fileid="{{displaydocument.fileid}}"><i class="fa fa-close"></i> 刪除</button>&nbsp;
                                {% if displaydocument.ismain == 1 %}
                                <button type="button" class="btn btn-xs btn-success main_picture" id="main_picture_button" action="main_picture" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displaydocument.fileid}}"><i class="fa fa-home"></i> 封面</button>
                                {% else %}
                                <button type="button" class="btn btn-xs btn-light main_picture" id="main_picture_button" action="main_picture" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" pictureid="{{forloop.counter}}" fileid="{{displaydocument.fileid}}"><i class="fa fa-home"></i> 封面</button>
                                {% endif %}
                            </div>
                        {% empty %}
                            <center>暫時未有相關文件</center>
                        {% endfor %}
                        <!--<div class="item"><a href="#" class="open_modal_picture" data-bs-toggle="modal" data-original-title="test" data-bs-target="#PictureModal" action="upload" formtype="property_info" formname="Property Information" propertyid="{{property_list.0.propertyid}}" propertyno="{{property_list.0.propertyno}}" propertyname="{{property_list.0.propertyname}}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}"><img src="/static/dist/img-web/property-cms/0/property_add.jpg" alt=""></a></div>-->
                      </div>
                    </div>
                  </form>
                  <link rel="stylesheet" type="text/css" href="{% static 'Koho/assets/css/vendors/photoswipe.css' %}">

                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card">
              <div class="card-body">
                <div class="product-info">
                  <h3 class="mt-4" style="font-weight:600">狀況</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">盤類</label>
                            <select class="form-select" id="offertype"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}>
                            {% for offertype in offertype_list %}
                                <option value="{{offertype.code_detail_name}}"{%if offertype.code_detail_name == property_list.0.offertype %} selected{% endif %}>{{offertype.code_detail_name}}</option>
                            {% endfor %}
                            </select>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">物業狀況</label>
                            <select class="form-select" id="possession"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}>
                            {% for possession in possession_list %}
                                <option value="{{possession.code_detail_name}}"{%if possession.code_detail_name == property_list.0.possession %} selected{% endif %}>{{possession.code_detail_name}}</option>
                            {% endfor %}
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>
                  <h3 class="mt-4" style="font-weight:600">面積及價錢</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">建築面積(平方呎，未核實)</label>
                            <input class="form-control" placeholder="" type="number" id="grossarea" value="{{property_list.0.grossarea}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">實用面積(平方呎)</label>
                            <input class="form-control" placeholder="" type="number" id="netarea" value="{{property_list.0.netarea}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">業主叫價</label>
                            <input class="form-control" placeholder="" type="number" id="sellingprice" value="{{property_list.0.sellingprice}}"{% if 1461 in request.session.accessright or 2476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>

                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">業主呎價(@)</label>
                            <input class="form-control" placeholder="" type="number" id="unitprice" value="{{property_list.0.unitprice}}"{% if 1461 in request.session.accessright or 2476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">業主叫租</label>
                            <input class="form-control" placeholder="" type="number" id="rent" value="{{property_list.0.rent}}"{% if 1461 in request.session.accessright or 2476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">業主呎租(@)</label>
                            <input class="form-control" placeholder="" type="number" id="unitrent" value="{{property_list.0.unitrent}}"{% if 1461 in request.session.accessright or 2476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>

                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">管理費/月</label>
                            <input class="form-control" placeholder="" type="number" id="managementfee" value="{{property_list.0.managementfee}}"{% if 1461 in request.session.accessright or 2476 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">管理費/呎(@)</label>
                            <input class="form-control" placeholder="" type="number" id="unitmanagementfee" value="{{property_list.0.unitmanagementfee}}"{% if 1461 in request.session.accessright or 2476 in request.session.accessright %}{% else %} disabled{% endif %}>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">差餉地租/季</label>
                            <input class="form-control" placeholder="" type="number" id="rates" value="{{property_list.0.rates}}"{% if 1461 in request.session.accessright or 2476 in request.session.accessright %}{% else %} disabled{% endif %}>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">差餉地租/呎(@)</label>
                            <input class="form-control" placeholder="" type="number" id="unitrates" value="{{property_list.0.unitrates}}"{% if 1461 in request.session.accessright or 2476 in request.session.accessright %}{% else %} disabled{% endif %}>
                          </div>
                        </div>
                        <div class="col-sm-12">
                            <ul class="list-group">
                                <li class="list-group-item list-group-item-warning">
                            <h5><b>備註：</b></h5>
                                <p>
                                    &nbsp;&nbsp;1) 如果物業用途是住宅，以上內容均以<b>實用面積</b>計算<br>
                                    &nbsp;&nbsp;2) 如果物業用途是商業、工業或商舖，以上內容均以<b>建築面積</b>計算<br>
                                </p>
                                </li>
                            </ul>
                        </div>
                      </div>
                    </div>
                  </form>

                  <h3 class="mt-4" style="font-weight:600">其他物業面積</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">閣樓(自建/入則)(平方呎)</label>
                            <input class="form-control" placeholder="" type="number" id="atticarea" value="{{property_list.0.atticarea|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2477 in request.session.accessright %}{% else %} disabled{% endif %}>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">平台(平方呎)</label>
                            <input class="form-control" placeholder="" type="number" id="platformarea" value="{{property_list.0.platformarea|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2477 in request.session.accessright %}{% else %} disabled{% endif %}>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">天台(平方呎)</label>
                            <input class="form-control" placeholder="" type="number" id="rooftoparea" value="{{property_list.0.rooftoparea|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2477 in request.session.accessright %}{% else %} disabled{% endif %}>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">花園(平方呎)</label>
                            <input class="form-control" placeholder="" type="number" id="gardenarea" value="{{property_list.0.gardenarea|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2477 in request.session.accessright %}{% else %} disabled{% endif %}>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>

                  <h3 class="mt-4" style="font-weight:600">現租務資料</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">現租客</label>
                            <input class="form-control" placeholder="" type="text" id="tenant" value="{{property_list.0.tenant|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2478 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-3">
                          <div class="mb-3">
                            <label class="form-label">現租金</label>
                            <input class="form-control" placeholder="" type="number" id="currentrent" value="{{property_list.0.currentrent|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2478 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-3">
                          <div class="mb-3">
                            <label class="form-label">回報率</label>
                            <input class="form-control" placeholder="" type="number" id="yield_field" value="{{property_list.0.yield_field|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2478 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">現租約期</label>
                            <input class="form-control" placeholder="" type="text" id="rentalperiod" value="{{property_list.0.rentalperiod|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2478 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">交吉日期</label>
                            <input class="form-control" placeholder="" type="date" id="rentalstartdate" value="{{property_list.0.rentalstartdate|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2478 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-12">
                            <ul class="list-group">
                                <li class="list-group-item list-group-item-warning">
                            <h5><b>備註：</b></h5>
                                <p>
                                    &nbsp;&nbsp;1) 如果輸入了業主叫價及現租金，系統會自動計出<b>回報率</b>
                                </p>
                                </li>
                            </ul>
                        </div>
                      </div>
                    </div>
                  </form>

                  <h3 class="mt-4" style="font-weight:600">前業主資料</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-12">
                          <div class="mb-3">
                            <label class="form-label">前業主</label>
                            <input class="form-control" placeholder="" type="text" id="formerowner" value="{{property_list.0.formerowner|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2478 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">成交價</label>
                            <input class="form-control" placeholder="" type="number" id="finalprice" value="{{property_list.0.finalprice|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2478 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">成交日期</label>
                            <input class="form-control" placeholder="" type="date" id="transactiondate" value="{{property_list.0.transactiondate|default_if_none:""}}"{% if 1461 in request.session.accessright or 1476 in request.session.accessright or 2478 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>
                  <h3 class="mt-4" style="font-weight:600">位置圖</h3>
                  <form>
                    <div class="product-group">
                      <div class="gallery my-gallery card-body row" itemscope="">
                        <figure class="col-xl-12 col-md-12 col-sm-12 xl-25 box-col-25" itemprop="associatedMedia" itemscope="">
                            <a href="/static/dist/img-web/property-cms/{{property_list.0.propertyid}}/location_map.png" itemprop="contentUrl" data-size="1600x950"><img class="img-thumbnail" src="/static/dist/img-web/property-cms/{{property_list.0.propertyid}}/location_map.png" itemprop="thumbnail" alt="位置圖">
                            </a>
                          <figcaption itemprop="caption description">位置圖</figcaption>
                        </figure>
                      </div>
                    </div>
                  </form>
                </div>
                <div class="mt-4">
                  <div class="row">
                    <div class="col-sm-12 text-end">
                    {% if propertyid != 0 %}
                        {% if 1461 in request.session.accessright or 2476 in request.session.accessright or 2477 in request.session.accessright or 2478 in request.session.accessright %}<button type="button" class="btn btn-success me-3" id="edit_button" action="edit">更改</button>{% endif %}
                        {% if 1477 in request.session.accessright %}<button type="button" class="btn btn-danger me-3" id="delete_button" action="delete">刪除</button>{% endif %}
                        <button type="button" class="btn btn-warning me-3" id="reset_button" action="reset">內容重設及新增物業</button>
                    {% else %}
                        <button type="button" class="btn btn-primary me-3" id="save_button" action="add">新增</button>
                    {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-body">
                <div class="product-info">
                  <h3 class="mt-4" style="font-weight:600">聯絡資料 <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="add" formtype="property_contact" formname="Property Contact" contactid="0" propertyid="{{ propertyid }}" contacttype="" company="" title="" person="" infotype="其他" contactinfo="" address="" ctcperson=""><i class="icofont icofont-plus-circle"></i></a></h3>
                      <div class="row">
                        <div class="col-sm-12 text-end">
                            <button type="button" class="btn btn-success me-3 show_contact" id="contact_detail_button" action="contact" propertyid="{{ propertyid }}">顯示聯絡資料</button>
                        </div>
                      </div>
                      <div class="table-responsive">
                        <table class="table table-hover" id="contentTable-contact" style="display:none">
                            <thead>
                                <tr style="text-align:center;background-color:#FFF8DB">
                                    <th width="30"></th>
                                    <th width="100">聯絡人身份</th>
                                    <th width="300">公司</th>
                                    <th width="200">姓名</th>
                                    <th width="100">聯絡類型</th>
                                    <th width="100">聯絡資料</th>
                                    <th>地址</th>
                                    <th width="150">CTC</th>
                                    <th width="100">登記人</th>
                                    <th style="text-align:center;" width="160">登記日期</th>
                                    <th width="60">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for displaydata in property_contact_list %}
                                <tr align="top">
                                    <td></td>
                                    <td valign="top" style="text-align:center;">
                                        {% if displaydata.ContactType == "買家" %}
                                            <span class="badge badge-success text-md">{{ displaydata.ContactType }}</span>
                                        {% elif displaydata.ContactType == "業主" %}
                                            <span class="badge badge-danger text-md">{{ displaydata.ContactType }}</span>
                                        {% elif displaydata.ContactType == "租客" %}
                                            <span class="badge badge-warning text-md">{{ displaydata.ContactType }}</span>
                                        {% elif displaydata.ContactType == "其他" %}
                                            <span class="badge badge-primary text-md">{{ displaydata.ContactType }}</span>
                                        {% endif %}
                                    </td>
                                    <td valign="top"><a class="show_related_property" contact_type="company" style="cursor:pointer" contact_data="{{ displaydata.Company|default_if_none:""|safe }}"><b>{{ displaydata.Company|default_if_none:""|safe }}</b></a></td>
                                    <td valign="top"><a class="show_related_property" contact_type="person" style="cursor:pointer" contact_data="{{ displaydata.Person|default_if_none:""|safe }}"><b>{{ displaydata.Person|default_if_none:""|safe }}</b></a>{% if displaydata.Title|default_if_none:"" != "" %}({{ displaydata.Title|default_if_none:""|safe }}){% endif %}</td>
                                    <td style="text-align:center;" valign="top">{{ displaydata.InfoType|default_if_none:""|safe }}</td>
                                    <td style="text-align:center;" valign="top"><a class="show_related_property" style="cursor:pointer" contact_type="phone" contact_data="{{ displaydata.ContactInfo|default_if_none:""|safe }}"><b>{{ displaydata.ContactInfo|default_if_none:""|safe }}</b></a>{% if displaydata.Email|default_if_none:"" != "" %}(電郵：{{ displaydata.Email|default_if_none:""|safe }}){% endif %}</td>
                                    <td valign="top">{{ displaydata.Address|default_if_none:""|safe }}</td>
                                    <td valign="top">{{ displaydata.CTCPerson|default_if_none:""|safe }}</td>
                                    <td valign="top">{{ displaydata.LoginNameDesc|default_if_none:""|safe }}</td>
                                    <td valign="top" style="text-align:center;">{{ displaydata.CreateDate|date:'Y/m/d H:i' }}</td>
                                    <td valign="top" style="text-align:center;">
                                        <ul class="action">
                                            <li class="edit"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="edit" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}" email="{{ displaydata.Email|default_if_none:"" }}"><i class="icofont icofont-edit"></i></a></li>
                                            <li class="copy"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="add" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}" email="{{ displaydata.Email|default_if_none:"" }}"><i class="icofont icofont-copy"></i></a>&nbsp;</li>
                                            <li class="edit"> <a class="show_related_property" contact_type="company" style="cursor:pointer" contact_data="{{ displaydata.Company|default_if_none:""|safe }}"><i class="icofont icofont-link"></i></a></li>
                                        </ul>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr align="top">
                                    <td align="center" colspan="11">沒有聯絡記錄</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div id="related-property">
                    </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-body">
                <div class="product-info">
                  <h3 class="mt-4" style="font-weight:600">跟進資料 <a href="#" class="open_follow" data-bs-toggle="modal" data-original-title="test" data-bs-target="#FollowModal" action="add" formtype="property_contact" formname="Property Contact" contactid="0" propertyid="{{ propertyid }}" status="跟進"><i class="icofont icofont-plus-circle"></i></a></h3>
                    <div class="table-responsive">
                        <table class="table table-hover" id="contentTable-follow">
                            <thead>
                                <tr style="text-align:center;background-color:#bfecff">
                                    <!--<th width="30"></th>-->
                                    <th width="100">日期</th>
                                    <th width="100">狀態</th>
                                    <th width="120">業主叫價(M)</th>
                                    <th width="120">業主叫價(@)</th>
                                    <th width="120">業主叫租(K)</th>
                                    <th width="120">業主叫租(@)</th>
                                    <th>描述</th>
                                    <th width="100">跟進人</th>
                                    <th style="text-align:center;" width="100">跟進時間</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for displaydata in property_follow_list %}
                                <tr align="top">
                                    <!--<td>
                                        <ul class="action">
                                            <li class="delete"> <a href="#" id="delete_follow_button" action="delete_follow" formtype="property_follow" formname="Property Follow" followid="{{ displaydata.FollowID }}" propertyid="{{ displaydata.PropertyID }}"><i class="icofont icofont-trash"></i></a></li>
                                        </ul>
                                    </td>-->
                                    <td valign="top" style="text-align:center;">{{ displaydata.FollowDate|date:'Y/m/d' }}</td>
                                    <td style="text-align:center;" valign="top">{{ displaydata.Status|default_if_none:""|safe }}</td>
                                    <td style="text-align:center;" valign="top">{% if displaydata.SellingPrice|default_if_none:"" != 0 %}{{ displaydata.SellingPrice|default_if_none:""|format_number_with_commas|safe }}{% endif %}</td>
                                    <td style="text-align:center;" valign="top">{% if displaydata.UnitPrice|default_if_none:"" != 0 %}{{ displaydata.UnitPrice|default_if_none:""|format_number_with_commas|safe }}{% endif %}</td>
                                    <td style="text-align:center;" valign="top">{% if displaydata.Rent|default_if_none:"" != 0 %}{{ displaydata.Rent|default_if_none:""|format_number_with_commas|safe }}{% endif %}</td>
                                    <td style="text-align:center;" valign="top">{% if displaydata.UnitRent|default_if_none:"" != 0 %}{{ displaydata.UnitRent|default_if_none:""|format_number_with_commas|safe }}{% endif %}</td>
                                    <td valign="top">{{ displaydata.Description|default_if_none:"" }}</td>
                                    <td valign="top">{{ displaydata.LoginNameDesc }}</td>
                                    <td valign="top" style="text-align:center;">{{ displaydata.FollowDate|date:'H:i' }}</td>
                                </tr>
                                {% empty %}
                                <tr align="top">
                                    <td align="center" colspan="10">沒有跟進記錄</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    {% endif %}

	{% if action == "property_info" %}
        <p style="padding-left:160px">
        {% if propertyid != "0" %}
            <h3 class="mt-4" style="font-weight:600;padding-left:20px">狀況資料 - {{property_list.0.propertyname}}</h3>
        {% else %}
            <h3 class="mt-4" style="font-weight:600;padding-left:20px">狀況資料</h3>
        {% endif %}
        </p>

      <div class="container-fluid add-product" id="editTable">
        <div class="row">
          <div class="col-lg-6">
            <div class="card">
              <div class="card-body">
                <div class="product-info">
                  <h3 class="mt-4" style="font-weight:600">物業資料</h3>
                  <form>
                    <input type="hidden" id="propertyid" value="{{property_list.0.propertyid}}">
                    <input type="hidden" id="propertyno" value="{{property_list.0.propertyno}}">
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-3"><label class="form-label">用途：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.usage}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">物業編號：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.propertyno}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">物業名稱：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.propertyname}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">地區：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.district}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">分區：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.subdistrict}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">街道：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.street}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">街號：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.streetno}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">大廈：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.building}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">樓層：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.floor}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">單位：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.unit}}</h5></div>
                      </div>
                    </div>
                  </form>

                  <h3 class="mt-4" style="font-weight:600">圖片({{property_file_list|length}})</h3>
                    <div class="row">
                      {% for displayfile in property_file_list %}
                      <div class="col-xs-6 col-md-4 col-sm-4">
                        <div class="product-details-box">
                          <div class="d-flex"><a href="#" data-bs-original-title="" title="">
                              {% setvar "/static/dist/img-web/property-cms/"|addtext:displayfile.propertyid|addtext:"/"|addtext:displayfile.filename as property_image %}
                              {% if ".mp4" in displayfile.filename %}
                                  <video width="100%" height="100%" controls>
                                    <source src="{{property_image}}" type="video/mp4">
                                    Your browser does not support the video tag.
                                  </video>
                              {% else %}
                                <img class="align-self-center img-fluid" src="{{property_image}}" alt="#"></a>
                              {% endif %}
                            <div class="flex-grow-1">

                            </div>
                          </div>
                        </div>
                      </div>
                      {% endfor %}
                    </div>
                    <h3 class="mt-4" style="font-weight:600">平面圖({{property_floorplan_list|length}})</h3>
                    <div class="row">
                      {% for displayfile in property_floorplan_list %}
                      <div class="col-xs-6 col-md-3 col-sm-3">
                        <div class="product-details-box">
                          <div class="d-flex"><a href="#" data-bs-original-title="" title=""><img class="align-self-center img-fluid" src="/static/dist/img-web/floorplan-cms/{{displayfile.propertyid}}/{{displayfile.filename}}" alt="#"></a>
                            <div class="flex-grow-1">

                            </div>
                          </div>
                        </div>
                      </div>
                      {% endfor %}
                    </div>
                    <h3 class="mt-4" style="font-weight:600">其他文件({{property_document_list|length}})</h3>
                    <div class="row">
                      {% for displayfile in property_document_list %}
                      <div class="col-xs-6 col-md-3 col-sm-3">
                        <div class="product-details-box">
                          <div class="d-flex"><a href="#" data-bs-original-title="" title=""><img class="align-self-center img-fluid" src="/static/dist/img-web/document-cms/{{displayfile.propertyid}}/{{displayfile.filename}}" alt="#"></a>
                            <div class="flex-grow-1">

                            </div>
                          </div>
                        </div>
                      </div>
                      {% endfor %}
                    </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-6">
            <div class="card">
              <div class="card-body">
                <div class="product-info">
                  <h3 class="mt-4" style="font-weight:600">狀況</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-12">
                          <div class="mb-3">
                            <label class="form-label">物業可用性</label>&nbsp;&nbsp;&nbsp;&nbsp;<span class="badge badge-success text-md availability-option">隨時</span> <span class="badge badge-success text-md availability-option">最快日期</span>
                            <input class="form-control" placeholder="" type="text" id="availability" value="{{property_list.0.availability|default_if_none:""}}"{% if 1461 in request.session.accessright or 2478 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-12">
                          <div class="mb-3">
                            <label class="form-label">景觀/ 裝修</label>&nbsp;&nbsp;&nbsp;&nbsp;<span class="badge badge-success text-md views-option">Bare Shell</span> <span class="badge badge-success text-md views-option">Building View</span> <span class="badge badge-success text-md views-option">Sea View</span>
                            <input class="form-control" placeholder="" type="text" id="views" value="{{property_list.0.views|default_if_none:""}}"{% if 1461 in request.session.accessright or 2478 in request.session.accessright %}{% else %} disabled{% endif %}><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-12">
                          <div class="mb-3">
                            <label class="form-label">備註</label>
                              <textarea class="form-control" placeholder=""  id="remarks" rows="5"{% if 1461 in request.session.accessright or 2478 in request.session.accessright %}{% else %} disabled{% endif %}>{{property_list.0.remarks|default_if_none:""}}</textarea><span class="text-danger"></span>
                          </div>
                        </div>
                      </div>
                        <div class="mt-4">
                          <div class="row">
                            <div class="col-sm-12 text-end">
                            {% if propertyid != "0" %}
                                {% if 1461 in request.session.accessright or 2478 in request.session.accessright %}<button type="button" class="btn btn-success me-3" id="edit_info_button" action="edit_info">儲存</button>{% endif %}
                            {% else %}
                                <button type="button" class="btn btn-primary me-3" id="save_info_button" action="add">新增</button>
                            {% endif %}
                            </div>
                          </div>
                        </div>
                    </div>
                  </form>
                  <h3 class="mt-4" style="font-weight:600">面積及價錢</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-6"><label class="form-label">建築面積(平方呎，未核實)：</label></div>
                        <div class="col-sm-6"><h5 style="font-weight:600">{{property_list.0.grossarea|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-6"><label class="form-label">實用面積(平方呎)：</label></div>
                        <div class="col-sm-6"><h5 style="font-weight:600">{{property_list.0.netarea|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-6"><label class="form-label">閣樓(自建/入則)(平方呎)：</label></div>
                        <div class="col-sm-6"><h5 style="font-weight:600">{{property_list.0.atticarea|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-6"><label class="form-label">平台(平方呎)：</label></div>
                        <div class="col-sm-6"><h5 style="font-weight:600">{{property_list.0.platformarea|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-6"><label class="form-label">天台(平方呎)：</label></div>
                        <div class="col-sm-6"><h5 style="font-weight:600">{{property_list.0.rooftoparea|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-6"><label class="form-label">花園(平方呎)：</label></div>
                        <div class="col-sm-6"><h5 style="font-weight:600">{{property_list.0.gardenarea|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><label class="form-label">業主叫價：</label></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">{{property_list.0.sellingprice|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">@{{property_list.0.unitprice|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><label class="form-label">業主叫租：</label></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">{{property_list.0.rent|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">@{{property_list.0.unitrent|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><label class="form-label">業管理費/月：</label></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">{{property_list.0.managementfee|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">@{{property_list.0.unitmanagementfee|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><label class="form-label">差餉地租/季：</label></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">{{property_list.0.rates|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">@{{property_list.0.unitrates|default_if_none:""|format_number_with_commas}}</h5></div>

                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endif %}

	{% if action == "property_oddsheet" %}
        <p style="padding-left:160px">
        {% if propertyid != 0 %}
            <h3 class="mt-4" style="font-weight:600;padding-left:20px">盤紙物業 - {{property_list.0.propertyname}}</h3>
        {% else %}
            <h3 class="mt-4" style="font-weight:600;padding-left:20px">盤紙物業</h3>
        {% endif %}
        </p>

      <div class="container-fluid add-product" id="oddsheetTable">
        <div class="row">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-body">
                <div class="product-info">
                  <h3 class="mt-4" style="font-weight:600">物業資料</h3>
                  <form>
                    <input type="hidden" id="propertyid" value="{{property_list.0.propertyid}}">
                    <input type="hidden" id="propertyno" value="{{property_list.0.propertyno}}">
                    <input type="hidden" id="propertyname" value="{{property_list.0.propertyname}}">
                    <input type="hidden" id="usage" value="{{property_list.0.usage}}">
                    <input type="hidden" id="offertype" value="{{property_list.0.offertype}}">
                    <input type="hidden" id="buildingtitle" value="{{property_list.0.building}}{{property_list.0.street}}{{property_list.0.streetno}}號">
                    <input type="hidden" id="oddsheetdate" value="{{today|date:'Y/m/d'}}">
                    <div class="product-group">
                      <div class="row" id="oddsheet" style="width:980px;">
                        <div class="col-sm-12">
                            <div style="max-width:940px;display:flex;justify-content: space-between;flex-wrap: nowrap;flex-direction: row;align-items: baseline;">
                                <div class="item-logo">
                                    <img src="{% static 'dist/img-web/main/infinyrealty_oddsheet.png' %}" alt='logo' width="180" class='img-fluid'/>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <div class="row" style="width:840px;display:flex;justify-content: space-between;flex-wrap: nowrap;flex-direction: row;align-items: baseline;">
                                <h4 style="font-weight:600;margin-bottom: 0px;"><br>以最終合約為依歸</h4>
                                <div>
                                    <h4 style="font-weight:600;margin-bottom: 0px;">{{today|date:'Y/m/d'}}</h4>
                                    <h4 style="font-weight:600;margin-bottom: 0px;">{{property_list.0.usage}} - {{property_list.0.offertype}}</h4>
                                </div>
                            </div>
                            <hr height="1px">
                        </div>
                        <style>
                            body { box-sizing: border-box;height: 100%;margin: 0;}
                        </style>
                        <div class="row">
                        <div class="col-sm-12" id="oddsheet_sellingpoint" style="border: 1px solid #ccc;padding:5px;margin:5px;text-align:center;"><label class="form-label"><h3>賣點</h3></label></div>
                        </div>
                        <div class="row">
                        <div class="col-sm-3"><label class="form-label"><h4>物業名稱</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">{{property_list.0.propertyname}}</h4></div>
                        <div class="col-sm-1">&nbsp;</div>
                        </div>
                        <div class="row">
                        <div class="col-sm-3"><label class="form-label"><h4>用途</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">{{property_list.0.usage}}</h4></div>
                        <div class="col-sm-1">&nbsp;</div>
                        </div>
                        {% if property_list.0.grossarea|default_if_none:"" != "" and property_list.0.grossarea|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>樓面面積</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">約 {{property_list.0.grossarea|default_if_none:""|format_number_with_commas}} 平⽅呎(建) (未核實)</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                        {% if property_list.0.netarea|default_if_none:"" != "" and property_list.0.netarea|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>實用面積(平方呎)</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">{{property_list.0.netarea|default_if_none:""|format_number_with_commas}}</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                        {% if property_list.0.atticarea|default_if_none:"" != "" and property_list.0.atticarea|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>閣樓(自建/入則)(平方呎)</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">{{property_list.0.atticarea|default_if_none:""|format_number_with_commas}}</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                        {% if property_list.0.platformarea|default_if_none:"" != "" and property_list.0.platformarea|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>平台(平方呎)</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">{{property_list.0.platformarea|default_if_none:""|format_number_with_commas}}</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                        {% if property_list.0.rooftoparea|default_if_none:"" != "" and property_list.0.rooftoparea|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>天台(平方呎)</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">{{property_list.0.rooftoparea|default_if_none:""|format_number_with_commas}}</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                        {% if property_list.0.gardenarea|default_if_none:"" != "" and property_list.0.gardenarea|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>花園(平方呎)</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">{{property_list.0.gardenarea|default_if_none:""|format_number_with_commas}}</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                        {% if property_list.0.sellingprice|default_if_none:"" != "" and property_list.0.sellingprice|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>業主叫價</h4></label></div>
                        <div class="col-sm-8" id="oddsheet_sell" content="{{property_list.0.sellingprice|default_if_none:""|format_number_with_commas}}"><h4 style="font-weight:600">港幣${{property_list.0.sellingprice|default_if_none:""|format_number_with_commas}}</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                        {% if property_list.0.rent|default_if_none:"" != "" and property_list.0.rent|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>業主叫租</h4></label></div>
                        <div class="col-sm-8" id="oddsheet_rent" content="{{property_list.0.rent|default_if_none:""|format_number_with_commas}}"><h4 style="font-weight:600">港幣${{property_list.0.rent|default_if_none:""|format_number_with_commas}}</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                        {% if property_list.0.managementfee|default_if_none:"" != "" and property_list.0.managementfee|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>管理費</h4></label></div>
                        <div class="col-sm-8" id="oddsheet_managementfee" content="{{property_list.0.managementfee|default_if_none:""|format_number_with_commas}}"><h4 style="font-weight:600">每⽉約港幣${{property_list.0.managementfee|default_if_none:""|format_number_with_commas}} (即每平⽅呎港幣${{property_list.0.unitmanagementfee|default_if_none:""|format_number_with_commas}})</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                        {% if property_list.0.rates|default_if_none:"" != "" and property_list.0.rates|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>差餉</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">每季港幣${{property_list.0.rates|default_if_none:""|format_number_with_commas}}</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}

                        {% if property_list.0.availability|default_if_none:"" != "" and property_list.0.availability != "None" and property_list.0.availability|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>物業可用性</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">{{property_list.0.availability|default_if_none:""|safe}}</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                        {% if property_list.0.views|default_if_none:"" != "" and property_list.0.views != "None" and property_list.0.views|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>景觀/ 裝修</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">{{property_list.0.views|default_if_none:""|safe}}</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                        {% if property_list.0.remarks|default_if_none:"" != "" and property_list.0.remarks != "None" and property_list.0.remarks|default_if_none:"" != "0" %}
                        <div class="row" onclick="hideRow(this)">
                        <div class="col-sm-3"><label class="form-label"><h4>備註</h4></label></div>
                        <div class="col-sm-8"><h4 style="font-weight:600">{{property_list.0.remarks|default_if_none:""|safe}}</h4></div>
                        <div class="col-sm-1"><i class="icofont icofont-ui-close oddsheet_delete"></i></div>
                        </div>
                        {% endif %}
                      </div>
                    </div>

                  <h3 class="mt-4" style="font-weight:600">附加資料</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-3">
                          <div class="mb-3">
                            <label class="form-label">項目</label>
                            <input class="form-control" placeholder="" type="text" list="itemnames" id="itemname" value=""><span class="text-danger"></span>
                            <datalist id="itemnames">
                                <option value="預設：最新業主叫價">預設：最新業主叫價</option>
                                <option value="預設：最新業主叫租">預設：最新業主叫租</option>
                                <option value="預設：最新管理費">預設：最新管理費</option>
                                <option value="預設：賣點">預設：賣點</option>
                                <!--<option value="物業圖片">物業圖片</option>
                                <option value="物業平面圖">物業平面圖</option>-->
                                <option value="門框大小">門框大小</option>
                                <option value="其他設施">其他設施</option>
                                <option value="回報率">回報率</option>
                                <option value="現租客">現租客</option>
                                <option value="租約內容">租約內容</option>
                                <option value="佣金">佣金</option>
                            </datalist>
                          </div>
                        </div>
                        <div class="col-sm-7">
                          <div class="mb-3">
                            <label class="form-label">內容</label>
                            <input class="form-control" placeholder="" type="text" id="itemcontent" value=""><span class="text-danger"></span>
                          </div>
                        </div>
                        <div class="col-sm-2">
                          <div class="mb-3">
                           <br>
                            <button type="button" class="btn btn-danger mb-3" propertyid="{{property_list.0.propertyid}}" id="add_item_button" action="add">加入</button>
                          </div>
                        </div>
                        <div class="col-sm-12">
                            <h3 class="mt-4" style="font-weight:600">平面圖({{property_floorplan_list|length}})</h3>
                            <div class="row">
                              {% for displayfile in property_floorplan_list %}
                              <div class="col-xxl-2 col-md-3 col-sm-3 box-col-20 xl-20">
                                <div class="product-details-box">
                                  <div class="d-flex"><a href="#" data-bs-original-title="" title=""><img class="align-self-center img-fluid property_image" src="/static/dist/img-web/floorplan-cms/{{displayfile.propertyid}}/{{displayfile.filename}}" alt="#" onclick="setItemContent(this)"></a>
                                    <div class="flex-grow-1">
                                        <input type="checkbox" id="floorplan_selection" value="{{displayfile.filename}}">&nbsp;加入盤紙
                                    </div>
                                  </div>
                                </div>
                              </div>
                              {% endfor %}
                            </div>
                            <h3 class="mt-4" style="font-weight:600">圖片({{property_file_list|length}})</h3>
                            <div class="row">
                              {% for displayfile in property_file_list %}
                              <div class="col-xxl-2 col-md-3 col-sm-3 box-col-20 xl-20">
                                <div class="product-details-box">
                                  <div class="d-flex"><a href="#" data-bs-original-title="" title=""><img class="align-self-center img-fluid property_image" src="/static/dist/img-web/property-cms/{{displayfile.propertyid}}/{{displayfile.filename}}" alt="#" onclick="setItemContent(this)"></a>
                                    <div class="flex-grow-1">
                                        <input type="checkbox" id="photo_selection" value="{{displayfile.filename}}">&nbsp;加入盤紙
                                    </div>
                                  </div>
                                </div>
                              </div>
                              {% endfor %}
                            </div>
                            <h3 class="mt-4" style="font-weight:600">位置圖</h3>
                            <div class="row">
                              <div class="col-xxl-12 col-md-12 col-sm-12 box-col-20 xl-20">
                                <div class="product-details-box">
                                  <div class="d-flex"><a href="#" data-bs-original-title="" title=""><img class="align-self-center img-fluid property_image" src="/static/dist/img-web/property-cms/{{property_list.0.propertyid}}/location_map.png" alt="#" onclick="setItemContent(this)"></a>
                                  </div>
                                </div>
                              </div>
                            </div>

                        </div>
                      </div>
                        <div class="mt-4">
                          <div class="row">
                            <div class="col-sm-12 text-center">
                            {% if propertyid != "0" %}
                                <!--<button type="button" class="btn btn-success me-3" id="create_offer_button" action="create_offer">預覽盤紙</button>
                                <a href="{% url 'offer_download' propertyid %}"><button type="button" class="btn btn-primary me-3" id="download_oddsheet_button" action="download_oddsheet" buttontype="pdf">儲存盤紙</button></a>-->
                                <button type="button" class="btn btn-primary me-3" id="reset_oddsheet_button" action="download_oddsheet" buttontype="pdf">重新整理盤紙</button>
                                <button type="button" class="btn btn-success me-3" id="create_oddsheet_button" action="create_oddsheet" buttontype="docx">建立盤紙</button>
                                <!--<button type="button" class="btn btn-warning me-3" id="download_oddsheet_button" action="download_oddsheet" buttontype="pdf">下載盤紙</button>-->
                                <a href="{% url 'oddsheet_download' propertyid %}"><button type="button" class="btn btn-warning me-3" id="download_oddsheet_button" action="download_oddsheet">下載盤紙</button></a>
                            {% else %}
                                <button type="button" class="btn btn-primary me-3" id="save_info_button" action="add">新增盤紙</button>
                            {% endif %}
                            </div>
                          </div>
                        </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endif %}

	{% if action == "property_oddsheet_multi" %}
        <p style="padding-left:160px">
            <h3 class="mt-4" style="font-weight:600;padding-left:20px">盤紙(多項)</h3>
        </p>

      <div class="container-fluid add-product" id="oddsheetTable">
        <div class="row">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-body">
                <div class="product-info">
                  <h3 class="mt-4" style="font-weight:600">物業資料</h3>
                  <form>
                    <input type="hidden" id="propertyid" value="{{property_list.0.propertyid}}">
                    <input type="hidden" id="propertyno" value="{{property_list.0.propertyno}}">
                    <input type="hidden" id="propertyname" value="{{property_list.0.propertyname}}">
                    <div class="product-group">
                      <div class="row" id="oddsheet">
                        <style>
                            body { box-sizing: border-box;height: 100%;margin: 0;}
                        </style>
                        <div class="col-sm-12" style="margin-bottom:20px">
                            <div class="footer-logo-area footer-logo-area-2" style="background-color:#491D79;max-width:1040px;display:flex;justify-content: space-between;flex-wrap: nowrap;flex-direction: row;align-items: baseline;">
                                <div class="item-logo">
                                    <img src="{% static 'dist/img-web/main/infinyrealty_logo_light.png' %}" alt='logo' width="280" class='img-fluid'/>
                                </div>
                                <div class="item">
                                   <h3 style="font-weight:600;color:white">{{today|date:'Y/m/d'}}&nbsp;&nbsp;</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <table class="display" id="contentTable" data-page-length="15">
                                <thead>
                                    <tr style="text-align:center;" class="bg-danger">
                                        <th width="20"></th>
                                        <th width="80">物業編號</th>
                                        <th width="60">用途</th>
                                        <th width="300">地址</th>
                                        <th width="80">建築面積</th>
                                        <th width="80">實用面積</th>
                                        <th style="text-align:center;" width="60">盤類</th>
                                        <th style="text-align:center;" width="80">業主叫價</th>
                                        <th style="text-align:center;" width="80">業主叫租</th>
                                        <th style="text-align:center;" width="80">管理費</th>
                                        <th width="100">物業狀況</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for displaydata in property_list %}
                                    <tr valign="top" onclick="hideRow(this)">
                                        <td data-filter="{{ displaydata.PropertyID }}">{{ forloop.counter }}</td>
                                        <td data-filter="{{ displaydata.PropertyNo }}">{{ displaydata.propertyno }}</td>
                                        <td style="text-align:center;" data-filter="{{ displaydata.Usage }}">{{ displaydata.usage }}</td>
                                        <td data-filter="{{ displaydata.PropertyName }}">{{ displaydata.propertyname }}</td>
                                        <td style="text-align:right;">{{ displaydata.grossarea|default_if_none:""|format_number_with_commas }}</td>
                                        <td style="text-align:right;">{{ displaydata.netarea|default_if_none:""|format_number_with_commas }}</td>
                                        <td style="text-align:center;" data-filter="{{ displaydata.OfferType }}">{{ displaydata.offertype }}</td>
                                        <td style="text-align:right;">{{ displaydata.sellingprice|default_if_none:""|format_number_with_commas }}</td>
                                        <td style="text-align:right;">{{ displaydata.rent|default_if_none:""|format_number_with_commas }}</td>
                                        <td style="text-align:right;">{{ displaydata.managementfee|default_if_none:""|format_number_with_commas }}</td>
                                        <td style="text-align:center;" data-filter="{{ displaydata.possession }}">
                                            {% if displaydata.possession == "現吉" %}<span class="badge badge-success text-md">{{displaydata.possession}}</span>{% endif %}
                                            {% if displaydata.possession == "商議" %}<span class="badge badge-warning text-md">{{displaydata.possession}}</span>{% endif %}
                                            {% if displaydata.possession == "連租約" %}<span class="badge badge-danger text-md">{{displaydata.possession}}</span>{% endif %}
                                            {% if displaydata.possession == "已售" %}<span class="badge badge-success text-md">{{displaydata.possession}}</span>{% endif %}
                                            {% if displaydata.possession == "已租" %}<span class="badge badge-success text-md">{{displaydata.possession}}</span>{% endif %}
                                            {% if displaydata.possession == "業主轉軚" %}<span class="badge badge-success text-md">{{displaydata.possession}}</span>{% endif %}
                                        </td>
                                        <td>
                                            <i class="icofont icofont-ui-close oddsheet_delete"></i>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                      </div>
                    </div>

                  <form>
                    <div class="product-group">
                        <div class="mt-4">
                          <div class="row">
                            <div class="col-sm-12 text-center">
                            {% if propertyid != "0" %}
                                <!--<button type="button" class="btn btn-success me-3" id="create_offer_button" action="create_offer">預覽盤紙</button>
                                <a href="{% url 'offer_download' propertyid %}"><button type="button" class="btn btn-primary me-3" id="download_oddsheet_button" action="download_oddsheet" buttontype="pdf">儲存盤紙</button></a>-->
                                <button type="button" class="btn btn-primary me-3" id="reset_oddsheet_multi_button" action="download_oddsheet" buttontype="pdf">重新整理盤紙</button>
                                <button type="button" class="btn btn-warning me-3" id="download_oddsheet_multi_button" action="download_oddsheet" buttontype="pdf">下載盤紙</button>
                            {% else %}
                                <button type="button" class="btn btn-primary me-3" id="save_info_button" action="add">新增盤紙</button>
                            {% endif %}
                            </div>
                          </div>
                        </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endif %}

	{% if action == "property_offer" %}
        <p style="padding-left:160px">
        {% if propertyid != "0" %}
            <h3 class="mt-4" style="font-weight:600;padding-left:20px">物業地址 - {{property_list.0.propertyname}}</h3>
        {% else %}
            <h3 class="mt-4" style="font-weight:600;padding-left:20px">物業地址</h3>
        {% endif %}
        </p>

      <div class="container-fluid add-product" id="editTable">
        <div class="row">
          <div class="col-lg-10">
            <div class="card">
              <div class="card-body">
                <div class="product-info">


                  <h3 class="mt-4" style="font-weight:600">要約</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-6">
                          <div class="mb-3">
                            <label class="form-label">檔案編號 :	<span id="recordno">{{property_list.0.propertyno|default_if_none:""|safe}}{{draftdate|date:"ymd"}}</span></label><br>
                            <label class="form-label">日 期	:	<span id="recorddate">{{draftdate|date:'Y年m月d日'}}</span></label>
                            <!--<input class="form-control" placeholder="" type="text" id="buyername" value=""><span class="text-danger"></span>-->
                          </div>
                        </div>
                        <div class="col-sm-6" style="margin-left: auto; margin-right: 0;"><u>以下資料只作參考用途</u><br>一切以正式合約為依歸</div>
                        <div class="col-sm-12">致 :	<input class="form-control" placeholder="公司名" type="text" list="companynames" id="companyname" value="" style="width:400px;display:inline">
                            <datalist id="companynames">
                            {% for displaydata in property_contact_list %}
                                <option value="{{displaydata.Company|default_if_none:""|safe}}">{{displaydata.Company|default_if_none:""|safe}}</option>
                            {% endfor %}
                            </datalist>
                            <br><input class="form-control" placeholder="客名" type="text" id="clientname" list="clientnames" value="" style="width:200px;margin-left:30px;display:inline">
                            <datalist id="clientnames">
                            {% for displaydata in property_contact_list %}
                                <option value="{{displaydata.Person|default_if_none:""|safe}}">{{displaydata.Person|default_if_none:""|safe}}</option>
                            {% endfor %}
                            </datalist>

                            大鑒</div>
                        <div class="col-sm-12"></div>
                        <div class="col-sm-12">有關物業 : <b><span id="propertyname">{{property_list.0.propertyname}}</span></b></div>
                        <div class="col-sm-12">敬啟者</div>
                        <div class="col-sm-1"></div>
                        <div class="col-sm-11">本公司現有一 “<input class="form-control" placeholder="租客類型" type="text" list="tenanttypes" id="tenanttype" value="" style="width:150px;display:inline">” 客戶對 貴公司之上述物業極感興趣， 曾於早前往實地磡察以了解實際情況。 就上述物業之租賃情況， 本公司之客戶提出下列洽租條件予   貴司參考， 冀雙方最終能達成協議，其提出之條件如下 : -
                            <datalist id="tenanttypes">
                                <option value="租客">租客</option>
                                <option value="買家">買家</option>
                            </datalist>
                        </div>
                        <div class="col-sm-1">(一)</div>
                        <div class="col-sm-2">物業地址	:</div>
                        <div class="col-sm-9">如上</div>
                        <div class="col-sm-1">(二)</div>
                        <div class="col-sm-2">建築面積	:</div>
                        <div class="col-sm-9">約 <input class="form-control" placeholder="" type="text" id="grossarea" value="{{property_list.0.grossarea|default_if_none:""|format_number_with_commas}}" style="width:150px;display:inline"> 平方呎</div>
                        <div class="col-sm-1">(三)</div>
                        <div class="col-sm-2">租用期	:</div>
                        <div class="col-sm-9"><input class="form-control" placeholder="" type="text" id="rentperiod" value="" style="width:150px;display:inline">年</div>
                        <div class="col-sm-1">(四)</div>
                        <div class="col-sm-2">租金	:</div>
                        <div class="col-sm-9">每月<input class="form-control" placeholder="" type="text" id="rent" value="{{property_list.0.rent|default_if_none:""|format_number_with_commas}}" style="width:150px;display:inline"> (全不包)；<br>另加生約<input class="form-control" placeholder="" type="number" id="liveyear" value="" style="width:50px;display:inline">年，租金加幅不多於<input class="form-control" placeholder="" type="number" id="increaserent" value="" style="width:50px;display:inline">%</div>
                        <div class="col-sm-1">(五)</div>
                        <div class="col-sm-2">起租期	:</div>
                        <div class="col-sm-9"><input class="form-control" placeholder="" type="date" id="startrent" value="" style="width:150px;display:inline"> ; 或商議</div>
                        <div class="col-sm-1">(六)</div>
                        <div class="col-sm-2">免租期	:</div>
                        <div class="col-sm-9"><input class="form-control" placeholder="" type="number" id="freemonth" value="" style="width:50px;display:inline"> 個月( 另免租期內之差餉、管理費、水、電及雜費由租客支付。)</div>
                        <div class="col-sm-1">(七)</div>
                        <div class="col-sm-2">按 金	:</div>
                        <div class="col-sm-9">相當於 <input class="form-control" placeholder="" type="text" id="monthlyrent" value="" style="width:150px;display:inline">個月租金,按金以首年租金計算,即HK$<input class="form-control" placeholder="" type="text" id="firstrent" value="" style="width:150px;display:inline"></div>
                        <div class="col-sm-1">(八)</div>
                        <div class="col-sm-2">差餉及管理費	:</div>
                        <div class="col-sm-9">約每月HK$<input class="form-control" placeholder="" type="text" id="ratemanagement" value="" style="width:150px;display:inline"> ; 由租客支付</div>
                        <div class="col-sm-1">(九)</div>
                        <div class="col-sm-2">簽約情況	:</div>
                        <div class="col-sm-9">(甲) 雙方簽署臨時租約時， 租方先付予業主相當於 <input class="form-control" placeholder="" type="number" id="depositmonth" value="" style="width:50px;display:inline">個月之租金按金作為臨時訂金</div>
                        <div class="col-sm-1"></div>
                        <div class="col-sm-2"></div>
                        <div class="col-sm-9">(乙) 於簽署臨時租約後，<input class="form-control" placeholder="" type="number" id="loyerdate" value="" style="width:50px;display:inline">天內雙方於指定之律師樓<br>	簽正式租約，向租客同時繳付 <input class="form-control" placeholder="" type="number" id="monthrent" value="" style="width:50px;display:inline">個月之租金按金<br>	及 <input class="form-control" placeholder="" type="number" id="previousmonth" value="" style="width:50px;display:inline">個月之上期予業主</div>
                        <div class="col-sm-1">(十)</div>
                        <div class="col-sm-2">釐印費	:</div>
                        <div class="col-sm-9">雙方平均支付</div>
                        <div class="col-sm-1">(十一)</div>
                        <div class="col-sm-2">律師費	:</div>
                        <div class="col-sm-9">雙方各自負責自己之律師費。</div>
                        <div class="col-sm-1">(十二)</div>
                        <div class="col-sm-2">業務性質	:</div>
                        <div class="col-sm-9"><input class="form-control" placeholder="業務性質" type="text" id="naturebusiness" value="" style="width:200px;display:inline"></div>
                        <div class="col-sm-1">(十三)</div>
                        <div class="col-sm-2">交吉情況	:</div>
                        <div class="col-sm-9">業主以 「<input class="form-control" placeholder="交吉情況" type="text" id="situation" value="" style="width:300px;display:inline">」上述物業予租客。</div>
                        <div class="col-sm-1">(十四)</div>
                        <div class="col-sm-2">備 註	:</div>
                        <div class="col-sm-9"><input class="form-control" placeholder="" type="text" id="remarks" value="" style="width:300px;display:inline"></div>
                        <div class="col-sm-1">(十五)</div>
                        <div class="col-sm-2">佣 金	:</div>
                        <div class="col-sm-9">本公司將收取業主 <input class="form-control" placeholder="" type="number" id="ownermonth" value="" style="width:50px;display:inline">個月租金作為服務費。</div>
                        <div class="col-sm-12">本公司之客戶極具誠意洽租 貴司之上述物業，敬希 貴公司能慎重考慮此客戶所提出之洽租條件。</div>
                        <div class="col-sm-12">承蒙鑒閱， 如有任何查詢， 敬希致電本公司職員 <input class="form-control" placeholder="" type="text" id="contactstaff" value="" style="width:200px;display:inline"> 。</div>
                        <div class="col-sm-12">祝 商祺</div>
                        <div class="col-sm-12"></div>
                        <div class="col-sm-9"></div>
                        <div class="col-sm-3">承灃物業有限公司</div>

                      </div>

                        <div class="mt-4">
                          <div class="row">
                            <div class="col-sm-12 text-end">
                            {% if propertyid != "0" %}
                                <button type="button" class="btn btn-success me-3" id="create_offer_button" action="create_offer">建立要約</button>
                                <a href="{% url 'offer_download' propertyid %}"><button type="button" class="btn btn-primary me-3" id="download_offer_button" action="download_offer">下載要約</button></a>
                            {% else %}
                                <button type="button" class="btn btn-primary me-3" id="save_info_button" action="add">新增要約</button>
                            {% endif %}
                            </div>
                          </div>
                        </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-10">
            <div class="card">
              <div class="card-body">
                <div class="product-info">
                  <h3 class="mt-4" style="font-weight:600">物業資料</h3>
                  <form>
                    <input type="hidden" id="propertyid" value="{{property_list.0.propertyid}}">
                    <input type="hidden" id="propertyno" value="{{property_list.0.propertyno}}">
                    <input type="hidden" id="propertyname" value="{{property_list.0.propertyname}}">
                    <input type="hidden" id="netarea" value="{{property_list.0.netarea}}">
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-3"><label class="form-label">用途：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.usage}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">物業編號：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.propertyno}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">物業名稱：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.propertyname}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">地區：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.district}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">分區：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.subdistrict}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">街道：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.street}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">街號：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.streetno}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">大廈：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.building}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">樓層：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.floor}}</h5></div>
                        <div class="col-sm-3"><label class="form-label">單位：</label></div>
                        <div class="col-sm-9"><h5 style="font-weight:600">{{property_list.0.unit}}</h5></div>
                      </div>
                    </div>
                  </form>

                  <h3 class="mt-4" style="font-weight:600">面積及價錢</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                        <div class="col-sm-6"><label class="form-label">建築面積(平方呎，未核實)：</label></div>
                        <div class="col-sm-6"><h5 style="font-weight:600">{{property_list.0.grossarea|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-6"><label class="form-label">實用面積(平方呎)：</label></div>
                        <div class="col-sm-6"><h5 style="font-weight:600">{{property_list.0.netarea|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><label class="form-label">業主叫價：</label></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">{{property_list.0.sellingprice|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">@{{property_list.0.unitprice|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><label class="form-label">業主叫租：</label></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">{{property_list.0.rent|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">@{{property_list.0.unitrent|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><label class="form-label">業管理費/月：</label></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">{{property_list.0.managementfee|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">@{{property_list.0.unitmanagementfee|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><label class="form-label">差餉地租/季：</label></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">{{property_list.0.rates|default_if_none:""|format_number_with_commas}}</h5></div>
                        <div class="col-sm-4"><h5 style="font-weight:600">@{{property_list.0.unitrates|default_if_none:""|format_number_with_commas}}</h5></div>

                      </div>
                    </div>
                  </form>

                  <h3 class="mt-4" style="font-weight:600">狀況</h3>
                  <form>
                    <div class="product-group">
                      <div class="row">
                            <div class="col-sm-4"><label class="form-label">物業可用性：</label></div>
                            <div class="col-sm-8"><h5 style="font-weight:600">{{property_list.0.availability|default_if_none:""|safe}}</h5></div>
                            <div class="col-sm-4"><label class="form-label">景觀/ 裝修：</label></div>
                            <div class="col-sm-8"><h5 style="font-weight:600">{{property_list.0.views|default_if_none:""|safe}}</h5></div>
                            <div class="col-sm-4"><label class="form-label">備註：</label></div>
                            <div class="col-sm-8"><h5 style="font-weight:600">{{property_list.0.remarks|default_if_none:""|safe}}</h5></div>
                        </div>
                      </div>
                    </div>
                  </form>

                  <h3 class="mt-4" style="font-weight:600">圖片</h3>
                    <div class="row">
                      {% for displayfile in property_file_list %}
                      <div class="col-xxl-3 col-md-3 col-sm-3 box-col-20 xl-20">
                        <div class="product-details-box">
                          <div class="d-flex"><a href="#" data-bs-original-title="" title=""><img class="align-self-center img-fluid" src="/static/dist/img-web/property-cms/{{displayfile.propertyid}}/{{displayfile.filename}}" alt="#"></a>
                            <div class="flex-grow-1">

                            </div>
                          </div>
                        </div>
                      </div>
                      {% endfor %}
                    </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    {% endif %}

	{% if action == "property_contact" %}
        <p style="padding-left:160px">
        {% if propertyid != "0" %}
            <h3 class="mt-4" style="font-weight:600;padding-left:20px">聯絡資料 - {{property_list.0.propertyname}} <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="add" formtype="property_contact" formname="Property Contact" contactid="0" propertyid="{{ propertyid }}" contacttype="" company="" title="" person="" infotype="其他" contactinfo="" address="" ctcperson=""><i class="icofont icofont-plus-circle"></i></a></h3>
        {% endif %}
        </p>
        <div class="table-responsive">
            <table class="table table-hover" id="contentTable">
                <thead>
                    <tr style="text-align:center;background-color:#FFF8DB">
                        <th width="30"></th>
                        <th width="100">聯絡人身份</th>
                        <th>公司</th>
                        <th width="250">姓名</th>
                        <th width="100">聯絡類型</th>
                        <th width="100">聯絡資料</th>
                        <th width="250">地址</th>
                        <th width="100">CTC</th>
                        <th width="100">登記人</th>
                        <th style="text-align:center;" width="160">登記日期</th>
                        <th width="60">操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for displaydata in property_contact_list %}
                    <tr align="top">
                        <td></td>
                        <td valign="top" style="text-align:center;">
                            {% if displaydata.ContactType == "買家" %}
                                <span class="badge badge-success text-md">{{ displaydata.ContactType }}</span>
                            {% elif displaydata.ContactType == "業主" %}
                                <span class="badge badge-danger text-md">{{ displaydata.ContactType }}</span>
                            {% elif displaydata.ContactType == "租客" %}
                                <span class="badge badge-warning text-md">{{ displaydata.ContactType }}</span>
                            {% elif displaydata.ContactType == "其他" %}
                                <span class="badge badge-primary text-md">{{ displaydata.ContactType }}</span>
                            {% endif %}
                        </td>
                        <td valign="top">{{ displaydata.Company|default_if_none:""|safe }}</td>
                        <td valign="top">{{ displaydata.Person|default_if_none:""|safe }}</td>
                        <td style="text-align:center;" valign="top">{{ displaydata.InfoType|default_if_none:""|safe }}</td>
                        <td style="text-align:center;" valign="top">{{ displaydata.ContactInfo|default_if_none:""|safe }}</td>
                        <td valign="top">{{ displaydata.Address|default_if_none:""|safe }}</td>
                        <td valign="top">{{ displaydata.CTCPerson|default_if_none:""|safe }}</td>
                        <td valign="top">{{ displaydata.LoginNameDesc|default_if_none:""|safe }}</td>
                        <td valign="top" style="text-align:center;">{{ displaydata.CreateDate|date:'Y/m/d H:i' }}</td>
                        <td valign="top" style="text-align:center;">
                            <ul class="action">
                                <li class="edit"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="edit" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}"><i class="icofont icofont-edit"></i></a></li>
                                <li class="copy"> <a href="#" class="open_contact" data-bs-toggle="modal" data-original-title="test" data-bs-target="#ContactModal" action="add" formtype="property_contact" formname="Property Contact" contactid="{{ displaydata.ContactID }}" propertyid="{{ displaydata.PropertyID }}" contacttype="{{ displaydata.ContactType|default_if_none:"" }}" company="{{ displaydata.Company|default_if_none:"" }}" title="{{ displaydata.Title|default_if_none:"" }}" person="{{ displaydata.Person|default_if_none:"" }}" infotype="{{ displaydata.InfoType|default_if_none:"" }}" contactinfo="{{ displaydata.ContactInfo|default_if_none:"" }}" address="{{ displaydata.Address|default_if_none:"" }}" ctcperson="{{ displaydata.CTCPerson|default_if_none:"" }}"><i class="icofont icofont-copy"></i></a>&nbsp;</li>
                            </ul>
                        </td>
                    </tr>
                    {% empty %}
                    <tr align="top">
                        <td align="center" colspan="11">沒有聯絡記錄</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

	{% if action == "property_contact_property" %}
        <p style="padding-left:160px">
            <h3 class="mt-4" style="font-weight:600;">相關物業</h3>
        </p>
        <div class="table-responsive">
            <table class="table display" id="contentTable" data-page-length="15">
                <thead>
                    <tr style="text-align:center;" class="bg-success">
                        <tr style="text-align:center;" class="bg-success">
                            <th width="100">物業編號</th>
                            <th width="100">用途</th>
                            <th>地址</th>
                            <th width="60">建築面積</th>
                            <th width="60">實用面積</th>
                            <th width="60">盤類</th>
                            <th style="text-align:center;" width="80">業主叫價</th>
                            <th style="text-align:center;" width="80">業主叫租</th>
                            <th style="text-align:center;" width="80">物業狀況</th>
                            <th style="text-align:center;" width="60">圖</th>
                            <th style="text-align:center;" width="110">更新日期</th>
                            <th width="60">操作</th>
                        </tr>
                    </tr>
                </thead>
                <tbody>
                    {% for displaydata in property_contact_property_list %}
                    <tr valign="top">
                        <td data-filter="{{ displaydata.PropertyNo }}">{{ displaydata.PropertyNo }}</td>
                        <td style="text-align:center;" data-filter="{{ displaydata.Usage }}">{{ displaydata.Usage }}</td>
                        <td data-filter="{{ displaydata.PropertyName }}">{{ displaydata.PropertyName }}{% if displaydata.FloorZone|default_if_none:"" != "" %}<font color="red">({{ displaydata.FloorZone|default_if_none:"" }})</font>{% endif %}</td>
                        <td style="text-align:right;">{{ displaydata.GrossArea|default_if_none:""|format_number_with_commas }}</td>
                        <td style="text-align:right;">{{ displaydata.NetArea|default_if_none:""|format_number_with_commas }}</td>
                        <td style="text-align:center;" data-filter="{{ displaydata.OfferType }}">{{ displaydata.OfferType }}</td>
                        <td style="text-align:right;">{{ displaydata.SellingPrice|format_numeric }}</td>
                        <!--<td style="text-align:center;">{{ displaydata.UnitPrice }}</td>-->
                        <td style="text-align:right;">{{ displaydata.Rent|format_numeric }}</td>
                        <!--<td style="text-align:center;">{{ displaydata.UnitRent }}</td>-->
                        <td style="text-align:center;" data-filter="{{ displaydata.Possession }}">
                            {% if displaydata.Possession == "現吉" %}<span class="badge badge-success text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "商議" %}<span class="badge badge-warning text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "連租約" %}<span class="badge badge-danger text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "已售" %}<span class="badge badge-success text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "已租" %}<span class="badge badge-success text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "封盤" %}<span class="badge badge-success text-md">{{displaydata.Possession}}</span>{% endif %}
                        </td>
                        <td style="text-align:center;">
                           {% if displaydata.FileName is not NULL %}
                                <img src="/static/dist/img-web/property-cms/{{displaydata.PropertyID}}/{{displaydata.FileName}}" width="60">
                                <!--<span class="badge badge-success text-md">O</span>-->
                           {% endif %}
                        </td>
                        <td style="text-align:center;">{{ displaydata.ModifyDate|date:'Y/m/d H:i' }}</td>
                        <td style="text-align:center;">
                           {% if 1476 in request.session.accessright or 1461 in request.session.accessright %}<a href="/property/{{ displaydata.PropertyID }}" class="open_edit" action="edit" formtype="property_info" formname="Property Information" propertyid="{{ displaydata.PropertyID }}" propertyno="{{ displaydata.PropertyNo }}" propertyname="{{ displaydata.PropertyName }}" usage="{{ displaydata.Usage }}" district="{{ displaydata.District }}" subdistrict="{{ displaydata.SubDistrict }}" street="{{ displaydata.Street }}" streetno="{{ displaydata.StreetNo }}" building="{{ displaydata.Building }}" floorzone="{{ displaydata.FloorZone }}" floor="{{ displaydata.Floor }}" unit="{{ displaydata.Unit }}" yield_field="{{ displaydata.Yield }}" tenant="{{ displaydata.tenant }}" currentrent="{{ displaydata.currentrent }}" rentalperiod="{{ displaydata.RentalPeriod }}" rentalstartdate="{{ displaydata.rentalstartdate }}" formerowner="{{ displaydata.formerowner }}" finalprice="{{ displaydata.finalprice }}" transactiondate="{{ displaydata.transactiondate }}" title="編輯物業"><i class="icofont icofont-edit"></i></a>{% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

	{% if action == "property_follow" %}
        <p style="padding-left:160px">
        {% if propertyid != "0" %}
            <h3 class="mt-4" style="font-weight:600;padding-left:20px">跟進資料 - {{property_list.0.propertyname}} <a href="#" class="open_follow" data-bs-toggle="modal" data-original-title="test" data-bs-target="#FollowModal" action="add" formtype="property_contact" formname="Property Contact" contactid="0" propertyid="{{ propertyid }}" status="跟進"><i class="icofont icofont-plus-circle"></i></a></h3>
        {% endif %}
        </p>
        <div class="table-responsive">
            <table class="table table-hover" id="contentTable">
                <thead>
                    <tr style="text-align:center;background-color:#bfecff">
                        <!--<th width="30"></th>-->
                        <th width="100">日期</th>
                        <th width="100">狀態</th>
                        <th width="120">業主叫價(@)</th>
                        <th width="120">業主叫價(M)</th>
                        <th width="120">業主叫租(@)</th>
                        <th width="120">業主叫租(K)</th>
                        <th>描述</th>
                        <th width="100">跟進人</th>
                        <th style="text-align:center;" width="100">跟進時間</th>
                    </tr>
                </thead>
                <tbody>
                    {% for displaydata in property_follow_list %}
                    <tr align="top">
                        <!--<td>
                            <ul class="action">
                                <li class="delete"> <a href="#" id="delete_follow_button" action="delete_follow" formtype="property_follow" formname="Property Follow" followid="{{ displaydata.FollowID }}" propertyid="{{ displaydata.PropertyID }}"><i class="icofont icofont-trash"></i></a></li>
                            </ul>
                        </td>-->
                        <td valign="top" style="text-align:center;">{{ displaydata.FollowDate|date:'Y/m/d' }}</td>
                        <td style="text-align:center;" valign="top">{{ displaydata.Status|default_if_none:""|safe }}</td>
                        <td style="text-align:center;" valign="top">{% if displaydata.SellingPrice|default_if_none:"" != 0 %}{{ displaydata.SellingPrice|default_if_none:""|format_number_with_commas|safe }}{% endif %}</td>
                        <td style="text-align:center;" valign="top">{% if displaydata.UnitPrice|default_if_none:"" != 0 %}{{ displaydata.UnitPrice|default_if_none:""|format_number_with_commas|safe }}{% endif %}</td>
                        <td style="text-align:center;" valign="top">{% if displaydata.Rent|default_if_none:"" != 0 %}{{ displaydata.Rent|default_if_none:""|format_number_with_commas|safe }}{% endif %}</td>
                        <td style="text-align:center;" valign="top">{% if displaydata.UnitRent|default_if_none:"" != 0 %}{{ displaydata.UnitRent|default_if_none:""|format_number_with_commas|safe }}{% endif %}</td>
                        <td valign="top">{{ displaydata.Description|default_if_none:"" }}</td>
                        <td valign="top">{{ displaydata.LoginNameDesc }}</td>
                        <td valign="top" style="text-align:center;">{{ displaydata.FollowDate|date:'H:i' }}</td>
                    </tr>
                    {% empty %}
                    <tr align="top">
                        <td align="center" colspan="10">沒有跟進記錄</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

	{% if action == "request_review" %}
        <table id="contentTable-{{action}}" class="table table-hover table-bordered" data-page-length="15">
            <thead class="thead-dark">
                <tr class="skin-blue" style="background-color: #EBA032;color:white">
                    <th style="text-align:center;" width="160">申請日期</th>
                    <th>地址</th>
                    <th style="text-align:center;" width="100">盤類</th>
                    <th style="text-align:center;" width="100">業主叫價</th>
                    <th style="text-align:center;" width="100">業主叫租</th>
                    <th style="text-align:center;" width="100">物業狀況</th>
                    <th style="text-align:center;" align="center" width="120">操作</th>
                </tr>
            </thead>
            <tbody>
                {% for displaydata in usageapproveright_list %}
                    <tr>
                        <td align="center">{{displaydata.ModifyDate|date:'Y-m-d H:i'}}</td>
                        <td>{{ displaydata.District }}{{ displaydata.SubDistrict }}{{ displaydata.Street }}{{ displaydata.StreetNo }}{{ displaydata.Building }}{{ displaydata.Floor }}{{ displaydata.Unit }}
                        </td>
                        <td style="text-align:center;">{{displaydata.OfferType|default_if_none:""|safe}}</td>
                        <td align="right">{{displaydata.SellingPrice|default_if_none:""|format_number_with_commas|safe}}</td>
                        <td align="right">{{displaydata.Rent|default_if_none:""|format_number_with_commas|safe}}</td>
                        <td style="text-align:center;">
                            {% if displaydata.Possession == "現吉" %}<span class="badge badge-success">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "商議" %}<span class="badge badge-warning">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "連租約" %}<span class="badge badge-danger">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "已售" %}<span class="badge badge-success text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "已租" %}<span class="badge badge-success text-md">{{displaydata.Possession}}</span>{% endif %}
                            {% if displaydata.Possession == "封盤" %}<span class="badge badge-success text-md">{{displaydata.Possession}}</span>{% endif %}
                        </td>
                        <td align="center">
                            <a href="#" class="badge badge-danger quick_approval" data-toggle="modal" data-target="#ApproveModal" action="approve" propertyid="{{ displaydata.PropertyID }}" approve="1"><i class="icon-pencil-alt"></i>&nbsp;&nbsp;特快審批</a>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td align="center" colspan="7">無任何審批申請記錄</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}

	{% if action == "team_list" %}
        {% setvar "" as tmpTeam %}
            <option value="">- 所有用戶 -</option>
        {% for displayuser in userlist|dictsort:"username"|dictsort:"rank_sequence"|dictsort:"team_sequence" %}
            {% if tmpTeam != displayuser.Team %}{% if tmpTeam == "" %}<optgroup label="{{displayuser.teamFullDesc}}">{% else %}</optgroup><optgroup label="{{displayuser.teamFullDesc}}">{% endif %}{% endif %}
            <option value="{{displayuser.LoginID}}" {% if user_loginid == displayuser.LoginID %} selected {% endif %}>{{displayuser.LoginNameDesc}} ({{displayuser.rankDesc}})</option>
            {% setvar displayuser.Team as tmpTeam %}
            {% if forloop.last %}</optgroup>{% endif %}
        {% endfor %}
    {% endif %}
{% endblock main_content %}

{% block custom_js %}
<script src="{% static 'Koho/assets/js/photoswipe/photoswipe.min.js' %}"></script>
<script src="{% static 'Koho/assets/js/photoswipe/photoswipe-ui-default.min.js' %}"></script>
<script src="{% static 'Koho/assets/js/photoswipe/photoswipe.js' %}"></script>
<script>
    function setItemContent(img) {
        var itemcontent = document.getElementById('itemcontent');
        itemcontent.value = img.src.split('/').pop();
    }
    function hideRow(row) {
        if (!(window.confirm("刪除此物業在盤紙上，你確定嗎？"))) {
            return false;
        }
        row.parentNode.removeChild(row);
        //row.style.display = "none";
    }

    $(".show_contact").off("click").on("click", function() {
        document.getElementById('contentTable-contact').style.display = '';
        document.getElementById('contact_detail_button').style.display = 'none';
        propertyid = $(this).attr("propertyid");
        $.ajax({
            url:'{% url 'property_save' %}',
            type:'POST',
            data:{action:"add_contact_log", accessid:"5158", propertyid:propertyid},
        })

        .done(function(response){
            /*
            messagetext = "狀況資料已成功更新"
            $.notify({
                message: messagetext
                },{
                    type: 'success',
                    allow_dismiss: true,
                    positon: 'top right',
                    offset: 20,
                    spacing: 10,
                    z_index: 1031,
            });
            */

        })

        .fail(function(xhr, status, error){
            // alert the error if any error occured
            $('#contentTable-contact').html(xhr.responseText);
            alert(xhr.responseText);
        })
    });

    $(".show_related_property").off("click").on("click", function() {
        contact_type = $(this).attr("contact_type");
        contact_data = $(this).attr("contact_data");
        $.ajax({
            url:'{% url 'ownerMain_response' %}',
            type:'POST',
            data:{action:"property_contact_property", contact_type:contact_type, contact_data:contact_data},
            beforeSend: function(){
                $('#related-property').html('<br/><br/><br/><br/><br/><center><div class=\"loader-box\"><div class=\"loader-2\"></div></div><br/></center></p>');
            },
        })

        .done(function(response){
            $('#related-property').html(response);
            /*
            messagetext = "狀況資料已成功更新"
            $.notify({
                message: messagetext
                },{
                    type: 'success',
                    allow_dismiss: true,
                    positon: 'top right',
                    offset: 20,
                    spacing: 10,
                    z_index: 1031,
            });
            */

        })

        .fail(function(xhr, status, error){
            // alert the error if any error occured
            $('#contentTable-contact').html(xhr.responseText);
            alert(xhr.responseText);
        })
    });

    $(".open_view").off("click").on("click", function() {
        usage = $(this).attr("usage");
        district = $(this).attr("district");
        subdistrict = $(this).attr("subdistrict");
        var propertyElement = document.getElementById('property_views'); // Get the element with ID "property_edit"
        if (usage == "全部") usage = "";
        propertyElement.setAttribute('usage', usage);
        $('a[href="#property_view"]').trigger('click');
    });

    $(".open_modal_picture").off("click").on("click", function() {
        $("#FunctionTitle").html("<i class='icon-plus'></i>&nbsp;&nbsp;<b>新增圖片</b>");
        $(".modal-header").css('background-color', '#DD4B39');
        //$("#action").val($(this).attr("action"));
        $("#filetype").val($(this).attr("filetype"));
        $("#propertyid").val($(this).attr("propertyid"));
        $("#propertyno_picture").html($(this).attr("propertyno"));
        $("#propertyname_picture").html($(this).attr("propertyname"));
        property_id = $(this).attr("propertyid");
        myDropzone.options.params.property_id = $(this).attr("propertyid");
        myDropzone.options.params.filetype = $(this).attr("filetype");
    });

    $("#create_oddsheet_button").off("click").on("click", function() {
        action = $(this).attr("action");
        propertyid = $("#propertyid").val();
        propertyno = $("#propertyno").val();
        propertyname = $("#propertyname").val();
        oddsheetdate = $("#oddsheetdate").val();
        usage = $("#usage").val();
        offertype = $("#offertype").val();
        sellingpoint = $("#oddsheet_sellingpoint").text();

        var oddsheet_content = document.getElementById("oddsheet").innerHTML;

        var checkboxes = document.querySelectorAll('#floorplan_selection');
        var floorplan_content = [];
        checkboxes.forEach(function(checkbox) {
          if (checkbox.checked) {
            floorplan_content.push(checkbox.value);
          }
        });
        var floorplan_content_string = floorplan_content.join(', ');
        var checkboxes = document.querySelectorAll('#photo_selection');
        var photo_content = [];
        checkboxes.forEach(function(checkbox) {
          if (checkbox.checked) {
            photo_content.push(checkbox.value);
          }
        });
        //alert(photo_content)
        var photo_content_string = photo_content.join(', ');

        // Saving Data into Database
        //alert('|action:' + action + '|propertyno:' + propertyno + '|propertyname:' + propertyname + '|oddsheetdate:' + oddsheetdate + '|usage:' + usage + '|offertype:' + offertype + '|sellingpoint:' + sellingpoint + '|floorplan_content:' + floorplan_content_string + '|photo_content:' + photo_content_string)

        if (action == 'create_oddsheet') {
            if (!(window.confirm("現在建立盤紙，你確定嗎？"))) {
                return false;
            }
        }

        $.ajax({
            url:'{% url 'oddsheet_response' %}',
            type:'POST',
            data:{action:action, propertyid:propertyid, propertyno:propertyno, propertyname:propertyname, oddsheetdate:oddsheetdate, usage:usage, offertype:offertype, sellingpoint:sellingpoint, oddsheet_content:oddsheet_content, floorplan_content:floorplan_content_string, photo_content:photo_content_string},
        })

        .done(function(response){
            //alert(response)
            if (response == "Create Success") {
                var messagetype = "success"
                if (action == "create_oddsheet") messagetext = propertyno+"盤紙資料已成功建立"
            } else {
                var messagetype = "danger"
                messagetext = "盤紙資料建立失敗，請重新再試！\n錯誤："+response
            }
            $.notify({
                message: messagetext
                },{
                    type: messagetype,
                    allow_dismiss: true,
                    positon: 'top right',
                    offset: 20,
                    spacing: 10,
                    z_index: 1031,
            });
        })

        .fail(function(xhr, status, error){
            // alert the error if any error occured
            //alert(xhr.responseText);
            $("#oddsheetTable").html(xhr.responseText);
        })
    })

    $("#create_offer_button").off("click").on("click", function() {
        action = $(this).attr("action");
        propertyid = $("#propertyid").val();
        propertyno = $("#propertyno").val();

        recordno = $("#recordno").text();
        recorddate = $("#recorddate").text();
        companyname = $("#companyname").val();
        clientname = $("#clientname").val();
        propertyname = $("#propertyname").val();
        tenanttype = $("#tenanttype").val();

        grossarea = $("#grossarea").val();
        rentperiod = $("#rentperiod").val();
        rent = $("#rent").val();
        liveyear = $("#liveyear").val();
        increaserent = $("#increaserent").val();
        startrent = $("#startrent").val();
        freemonth = $("#freemonth").val();
        monthlyrent = $("#monthlyrent").val();
        firstrent = $("#firstrent").val();
        ratemanagement = $("#ratemanagement").val();
        depositmonth = $("#depositmonth").val();
        loyerdate = $("#loyerdate").val();
        monthrent = $("#monthrent").val();
        previousmonth = $("#previousmonth").val();
        naturebusiness = $("#naturebusiness").val();
        situation = $("#situation").val();
        remarks = $("#remarks").val();
        ownermonth = $("#ownermonth").val();
        contactstaff = $("#contactstaff").val();

        // Saving Data into Database
        //alert('|action:' + action + '\npropertyno:' + propertyno + '\npropertyname:' + propertyname + '\nrecordno:' + recordno + '\nrecorddate:' + recorddate + '\ncompanyname:' + companyname + '\nclientname:' + clientname + '\ngrossarea:' + grossarea + '\nrentperiod:' + rentperiod + '\nrent:' + rent + '\nliveyear:' + liveyear + '\nincreaserent:' + increaserent + '\nstartrent:' + startrent + '\nfreemonth:' + freemonth + '\nmonthlyrent:' + monthlyrent + '\nfirstrent:' + firstrent + '\nratemanagement:' + ratemanagement + '\ndepositmonth:' + depositmonth + '\nloyerdate:' + loyerdate + '\nmonthrent:' + monthrent + '\npreviousmonth:' + previousmonth + '\nnaturebusiness:' + naturebusiness + '\nsituation:' + situation + '\nremarks:' + remarks + '\nownermonth:' + ownermonth + '\ncontactstaff:' + contactstaff);
        if (companyname == "") {
            alert("請輸入公司名");
            $("#companyname").focus();
            return false
        }
        if (clientname == "") {
            alert("請輸入客名");
            $("#clientname").focus();
            return false
        }
        if (tenanttype == "") {
          alert("請選擇租客類型");
          $("#tenanttype").focus();
          return false;
        }

        if (grossarea == "") {
          alert("請輸入建築面積");
          $("#grossarea").focus();
          return false;
        }

        if (rentperiod == "") {
          alert("請輸入租用期");
          $("#rentperiod").focus();
          return false;
        }

        if (rent == "") {
          alert("請輸入租金");
          $("#rent").focus();
          return false;
        }

        if (liveyear == "") {
          alert("請輸入生約年期");
          $("#liveyear").focus();
          return false;
        }

        if (increaserent == "") {
          alert("請輸入租金加幅不多於百分比");
          $("#increaserent").focus();
          return false;
        }

        if (startrent == "") {
          alert("請輸入起租期");
          $("#startrent").focus();
          return false;
        }

        if (freemonth == "") {
          alert("請輸入免租期");
          $("#freemonth").focus();
          return false;
        }

        if (monthlyrent == "") {
          alert("請輸入免租期月份數目");
          $("#monthlyrent").focus();
          return false;
        }

        if (firstrent == "") {
          alert("請輸入首年租金");
          $("#firstrent").focus();
          return false;
        }

        if (ratemanagement == "") {
          alert("請輸入差餉及管理費");
          $("#ratemanagement").focus();
          return false;
        }
        if (depositmonth == "") {
          alert("請輸入簽約情況租方先付予業主相當於多少個月之租金按金");
          $("#depositmonth").focus();
          return false;
        }
        if (loyerdate == "") {
          alert("請輸入多少天內雙方於指定之律師樓");
          $("#loyerdate").focus();
          return false;
        }
        if (monthrent == "") {
          alert("請輸入多少個月之租金按金");
          $("#monthrent").focus();
          return false;
        }
        if (previousmonth == "") {
          alert("請輸入多少個月之上期予業主");
          $("#previousmonth").focus();
          return false;
        }
        if (naturebusiness == "") {
          alert("請輸入業務性質");
          $("#naturebusiness").focus();
          return false;
        }

        if (situation == "") {
          alert("請輸入交吉情況");
          $("#situation").focus();
          return false;
        }
        if (ownermonth == "") {
          alert("請輸入收取業主多少個月租金作為服務費");
          $("#ownermonth").focus();
          return false;
        }

        if (contactstaff == "") {
          alert("請輸入聯繫人");
          $("#contactstaff").focus();
          return false;
        }
        if (action == 'create_offer') {
            if (!(window.confirm("現在建立要約信件，你確定嗎？"))) {
                return false;
            }
        }

        $.ajax({
            url:'{% url 'offer_response' %}',
            type:'POST',
            data:{action:action, propertyid:propertyid, propertyno:propertyno, propertyname:propertyname, recordno:recordno, recorddate:recorddate, companyname:companyname, clientname:clientname,  tenanttype: tenanttype,  grossarea: grossarea,  rentperiod: rentperiod,  rent: rent,  liveyear: liveyear,  increaserent: increaserent,  startrent: startrent, freemonth: freemonth,  monthlyrent: monthlyrent, firstrent: firstrent,  ratemanagement: ratemanagement,  depositmonth: depositmonth,  loyerdate: loyerdate,  monthrent: monthrent,  previousmonth: previousmonth,  naturebusiness: naturebusiness,  situation: situation,  remarks: remarks, ownermonth: ownermonth, contactstaff: contactstaff},
        })

        .done(function(response){
            //alert(response)
            if (action == "create_offer") messagetext = propertyno+"要約資料已成功建立"
            $.notify({
                message: messagetext
                },{
                    type: 'success',
                    allow_dismiss: true,
                    positon: 'top right',
                    offset: 20,
                    spacing: 10,
                    z_index: 1031,
            });
        })

        .fail(function(xhr, status, error){
            // alert the error if any error occured
            //alert(xhr.responseText);
            $("#recordno").html(xhr.responseText);
        })
    })

    $(".delete_picture").off("click").on("click", function() {
        $("#action").val($(this).attr("action"));
        action = $(this).attr("action");
        pictureid = $(this).attr("pictureid");
        fileid = $(this).attr("fileid");
        //myDropzone.options.params.property_id = $(this).attr("propertyid");
        if (!(window.confirm("刪除圖片#"+pictureid+"，你確定嗎？"))) {
            return false;
        }
        if (action == "delete_picture") {
            $.ajax({
                url:'{% url 'ownerMain_response' %}',
                type:'POST',
                data:{action:"delete_picture", fileid:fileid},
            })
            .done(function(response){
                $.notify({
                    message: "圖片已成功刪除"
                    },{
                        type: 'success',
                        allow_dismiss: true,
                        positon: 'top right',
                        offset: 20,
                        spacing: 10,
                        z_index: 1031,
                });
                var tabContent = document.querySelector('.tab-content');
                var activeTabPanel = tabContent.querySelector('.tab-pane.active');
                $('a[href="#'+activeTabPanel.id+'"]').trigger('click');
            })
            .fail(function(xhr, status, error){
                $('.modal-message').html(xhr.responseText);
                alert(xhr.responseText);
            })
        }
    });

    $(".main_picture").off("click").on("click", function() {
        $("#action").val($(this).attr("action"));
        action = $(this).attr("action");
        propertyid = $(this).attr("propertyid");
        pictureid = $(this).attr("pictureid");
        fileid = $(this).attr("fileid");
        //myDropzone.options.params.property_id = $(this).attr("propertyid");
        if (!(window.confirm("圖片#"+pictureid+"設定為封面圖片，你確定嗎？"))) {
            return false;
        }
        if (action == "main_picture") {
            $.ajax({
                url:'{% url 'ownerMain_response' %}',
                type:'POST',
                data:{action:"main_picture", propertyid:propertyid, fileid:fileid},
            })
            .done(function(response){
                $.notify({
                    message: "圖片#"+pictureid+"已設定為封面圖片"
                    },{
                        type: 'success',
                        allow_dismiss: true,
                        positon: 'top right',
                        offset: 20,
                        spacing: 10,
                        z_index: 1031,
                });
                var tabContent = document.querySelector('.tab-content');
                var activeTabPanel = tabContent.querySelector('.tab-pane.active');
                $('a[href="#'+activeTabPanel.id+'"]').trigger('click');
            })
            .fail(function(xhr, status, error){
                $('.modal-message').html(xhr.responseText);
                //alert("xx"+xhr.responseText);
            })
        }
    });

    $(".approve_picture").off("click").on("click", function() {
        $("#action").val($(this).attr("action"));
        action = $(this).attr("action");
        propertyid = $(this).attr("propertyid");
        pictureid = $(this).attr("pictureid");
        fileid = $(this).attr("fileid");
        approve = $(this).attr("approve");
        //myDropzone.options.params.property_id = $(this).attr("propertyid");
        if (approve == 1) {
            if (!(window.confirm("圖片/平面圖#"+pictureid+"可以在網頁顯示，你確定嗎？"))) {
                return false;
            }
        } else {
            if (!(window.confirm("圖片/平面圖#"+pictureid+"取消在網頁顯示，你確定嗎？"))) {
                return false;
            }
        }
        if (action == "approve_picture") {
            $.ajax({
                url:'{% url 'ownerMain_response' %}',
                type:'POST',
                data:{action:"approve_picture", propertyid:propertyid, fileid:fileid, approve:approve},
            })
            .done(function(response){
                $.notify({
                    message: "圖片#"+pictureid+"已設定為封面圖片"
                    },{
                        type: 'success',
                        allow_dismiss: true,
                        positon: 'top right',
                        offset: 20,
                        spacing: 10,
                        z_index: 1031,
                });
                var tabContent = document.querySelector('.tab-content');
                var activeTabPanel = tabContent.querySelector('.tab-pane.active');
                $('a[href="#'+activeTabPanel.id+'"]').trigger('click');
            })
            .fail(function(xhr, status, error){
                $('.modal-message').html(xhr.responseText);
                //alert("xx"+xhr.responseText);
            })
        }
    });

    document.addEventListener('modalClosed', function() {
      // Refresh the page or perform any other refresh logic
      location.reload();
    });
    $(".open_contact").off("click").on("click", function() {
        var action = $(this).attr("action");
        $("#action").val($(this).attr("action"));
        $("#contactid").val($(this).attr("contactid"));
        $("#propertyid").val($(this).attr("propertyid"));
        if ($(this).attr("contacttype") == "業主") $("#radio1").prop("checked", true);
        if ($(this).attr("contacttype") == "買家") $("#radio2").prop("checked", true);
        if ($(this).attr("contacttype") == "租客") $("#radio3").prop("checked", true);
        if ($(this).attr("contacttype") == "其他") $("#radio4").prop("checked", true);
        $("#TxtCompany").val($(this).attr("company"));
        $("#TxtTitle").val($(this).attr("title"));
        $("#TxtPerson").val($(this).attr("person"));
        $("#TxtAddress").val($(this).attr("address"));
        $("#SelectInfoType").val($(this).attr("infotype"));
        $("#TxtContactInfo").val($(this).attr("contactinfo"));
        $("#TxtCTCPerson").val($(this).attr("ctcperson"));
        $("#TxtContactEmail").val($(this).attr("email"));
        if (action == "add") {
            $(".modal-header").css('background-color', '#DD4B39');
            $("#ContactModal #FunctionTitle").html("<i class='icon-plus'></i>&nbsp;&nbsp;<b>新增聯絡資料</b>");
            $("#add_contact_button").show();
            $("#edit_contact_button").hide();
            $("#remove_contact_button").hide();
            if ($(this).attr("contactid") != "0") {
                $("#TxtContactInfo").val("");
                $("#TxtCTCPerson").val("");
            } else {
                $("#radio4").prop("checked", true)
            }
        } else {
            $(".modal-header").css('background-color', '#0D4B39');
            $("#ContactModal #FunctionTitle").html("<i class='icon-plus'></i>&nbsp;&nbsp;<b>編輯聯絡資料</b>");
            $("#add_contact_button").hide();
            $("#edit_contact_button").show();
            $("#remove_contact_button").show();
        }
    });

    $(".open_follow").off("click").on("click", function() {
        var action = $(this).attr("action");
        $("#action").val($(this).attr("action"));
        $("#followid").val($(this).attr("followid"));
        $("#propertyid").val($(this).attr("propertyid"));
        if ($(this).attr("status") == "開價") $("#radio5").prop("checked", true);
        if ($(this).attr("status") == "跟進") $("#radio6").prop("checked", true);
        if ($(this).attr("status") == "還價") $("#radio7").prop("checked", true);
        if ($(this).attr("status") == "完成") $("#radio8").prop("checked", true);
        $("#TxtSellingPrice").val($(this).attr("sellingprice"));
        $("#TxtUnitPrice").val($(this).attr("unitprice"));
        $("#TxtRent").val($(this).attr("rent"));
        $("#TxtUnitRent").val($(this).attr("unitrent"));
        $("#TxtDescription").val($(this).attr("description"));
        if (action == "add") {
            $(".modal-header").css('background-color', '#DD4B39');
            $("#FollowModal #FunctionTitle").html("<i class='icon-plus'></i>&nbsp;&nbsp;<b>新增跟進資料</b>");
            $("#add_follow_button").show();
            $("#edit_follow_button").hide();
            $("#remove_follow_button").hide();
            if ($(this).attr("followid") == "0") {
                $("#radio6").prop("checked", true)
            }
        } else {
            $(".modal-header").css('background-color', '#0D4B39');
            $("#FollowModal #FunctionTitle").html("<i class='icon-plus'></i>&nbsp;&nbsp;<b>編輯跟進資料</b>");
            $("#add_follow_button").hide();
            $("#edit_follow_button").show();
            $("#remove_follow_button").show();
        }
    });

{% if action == "usage_view" %}
    document.getElementById('searchpropertyno').addEventListener('keypress', function(event) {
        // Check if the key pressed is 'Enter' (key code 13)
        if (event.key === 'Enter') {
            event.preventDefault(); // Prevent the default form submission
            var propertyElement = document.getElementById('property_views'); // Get the element with ID "property_edit"
            propertyElement.setAttribute('searchtext', $("#searchpropertyno").val());
            var tabContent = document.querySelector('.tab-content');
            var activeTabPanel = tabContent.querySelector('.tab-pane.active');
            $('a[href="#property_view"]').trigger('click');
        }
    });
{% endif %}
{% if action == "property_view" or action == "company_view" or action == "ctc_view" or action == "email_view" %}
    $("#searchinput").on("keyup change", function() {
        var oTable = $('#contentTable').dataTable();
        oTable.fnFilter($(this).val());
    });

    $(".btn_list_extend").click(function(){
      $(this).parent().toggleClass("extend"); 
      $(this).children().toggleClass("fa-angle-down"); 
      $(this).children().toggleClass("fa-angle-up"); 
    });

    $("#cboUsage1").on('change', function(){
        var val = $(this).val();
        table.column( 1 )
            .search(val, true, false)
            .draw();
    });

    $("#cboOfferType").on('change', function(){
        var val = $(this).val();
        table.column( 6 )
            .search(val, true, false)
            .draw();
    });

    $("#cboPossession").on('change', function(){
        var val = $(this).val();
        table.column( 11 )
            .search(val, true, false)
            .draw();
    });

    $("#cboArea").on('change', function(){
        var val = $(this).val();
        if (val == "港島") val = "香港";
        table.column( 3 )
            .search(val, true, false)
            .draw();
    });

    $("#cboSubDistrict").on('change', function(){
        var val = $(this).val();
        table.column( 3 )
            .search(val, true, false)
            .draw();
    });

    $("#cboStreet").on('change', function(){
        var val = $(this).val();
        table.column( 3 )
            .search(val, true, false)
            .draw();
    });

    $("#cboBuilding").on('change', function(){
        var val = $(this).val();
        table.column( 3 )
            .search(val, true, false)
            .draw();
    });

    $("#searchinput").val($("#property_views").attr("searchtext"));

    $(".open_edit").click(function(){
        // Adding the Value from Table to Modal form
        $("#action").val($(this).attr("action"));
        $("#propertyid").val($(this).attr("propertyid"));
        $("#usage").val($(this).attr("usage"));
        $("#district").val($(this).attr("district"));
        $("#subdistrict").val($(this).attr("subdistrict"));

        var value = $(this).attr("propertyid"); // Set the lock value to the desired value
        var propertyElement = document.getElementById('property_views'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_edits'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_infos'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_oddsheets'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_offers'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        //var propertyElement = document.getElementById('property_contacts'); // Get the element with ID "property_edit"
        //propertyElement.setAttribute('propertyid', value);
        //var propertyElement = document.getElementById('property_follows'); // Get the element with ID "property_edit"
        //propertyElement.setAttribute('propertyid', value);
        $("#propertyid").val(value);

        $('a[href="#property_edit"]').trigger('click');
    });

    $(".open_oddsheet").off("click").on("click", function() {
        // Adding the Value from Table to Modal form
        $("#action").val($(this).attr("action"));
        $("#propertyid").val($(this).attr("propertyid"));
        $("#usage").val($(this).attr("usage"));
        $("#district").val($(this).attr("district"));
        $("#subdistrict").val($(this).attr("subdistrict"));

        var value = $(this).attr("propertyid"); // Set the lock value to the desired value
        var propertyElement = document.getElementById('property_views'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_edits'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_infos'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_oddsheets'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_offers'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_oddsheets_multi'); // Get the element with ID "property_edit"
        //propertyElement.setAttribute('propertyid', value);
        var selectedValues = table.column(0).checkboxes.selected();
        // Display the selected values
        if (selectedValues.length > 0) {
          var message = "Selected values:\n";
          var listvalue = "";
          for (var i = 0; i < selectedValues.length; i++) {
            message += selectedValues[i] + "\n";
            listvalue += selectedValues[i] + ","
          }
          listvalue = listvalue.slice(0, -1);
          propertyElement.setAttribute('propertyid_list', listvalue);
          $('a[href="#property_oddsheet_multi"]').trigger('click');
        } else {
          $('a[href="#property_oddsheet"]').trigger('click');
        }
    });

    $(".open_offer").off("click").on("click", function() {
        // Adding the Value from Table to Modal form
        $("#action").val($(this).attr("action"));
        $("#propertyid").val($(this).attr("propertyid"));
        $("#usage").val($(this).attr("usage"));
        $("#district").val($(this).attr("district"));
        $("#subdistrict").val($(this).attr("subdistrict"));

        var value = $(this).attr("propertyid"); // Set the lock value to the desired value
        var propertyElement = document.getElementById('property_views'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_edits'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_infos'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_oddsheets'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        var propertyElement = document.getElementById('property_offers'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', value);
        //var propertyElement = document.getElementById('property_contacts'); // Get the element with ID "property_edit"
        //propertyElement.setAttribute('propertyid', value);
        //var propertyElement = document.getElementById('property_follows'); // Get the element with ID "property_edit"
        //propertyElement.setAttribute('propertyid', value);

        $('a[href="#property_offer"]').trigger('click');
    });

    $(".show_related_property").off("click").on("click", function() {
        contact_type = $(this).attr("contact_type");
        contact_data = $(this).attr("contact_data");
        $.ajax({
            url:'{% url 'property_response' %}',
            type:'POST',
            data:{action:"property_contact_property", contact_type:contact_type, contact_data:contact_data},
            beforeSend: function(){
                $('#related-property').html('<br/><br/><br/><br/><br/><center><div class=\"loader-box\"><div class=\"loader-2\"></div></div><br/></center></p>');
            },
        })

        .done(function(response){
            $('#related-property').html(response);
            /*
            messagetext = "狀況資料已成功更新"
            $.notify({
                message: messagetext
                },{
                    type: 'success',
                    allow_dismiss: true,
                    positon: 'top right',
                    offset: 20,
                    spacing: 10,
                    z_index: 1031,
            });
            */

        })

        .fail(function(xhr, status, error){
            // alert the error if any error occured
            $('#contentTable-contact').html(xhr.responseText);
            alert(xhr.responseText);
        })
    });

    refresh_table();
{% endif %}

{% if action == "request_review" %}
    $(document).ready(function(){
        $(".quick_approval").click(function(){
            action = $(this).attr("action");
            propertyid = $(this).attr("propertyid");
            approve = $(this).attr("approve");

            if (action == "approve") {
                $.ajax({
                    url:'{% url 'ownerMain_response' %}',
                    type:'POST',
                    data:{action:"request_review_update", propertyid:propertyid, approve:approve},
                })
                .done(function(response){
                    $.notify({
                        message: "申請已獲批准."
                        },{
                            type: 'success',
                            allow_dismiss: true,
                            positon: 'top right',
                            offset: 20,
                            spacing: 10,
                            z_index: 1031,
                    });
                    var tabContent = document.querySelector('.tab-content');
                    var activeTabPanel = tabContent.querySelector('.tab-pane.active');
                    $('a[href="#'+activeTabPanel.id+'"]').trigger('click');
                })
                .fail(function(xhr, status, error){
                    $('.modal-message').html(xhr.responseText);
                    alert(xhr.responseText);
                })
            }

        });
    })
{% endif %}
{% if action == "menutab" %}
    action = "company_view";
    team = $("#cboTeam").val();
    loginid = $("#cboUser").val();
    $.ajax({
        url:'{% url 'ownerMain_response' %}',
        type:'POST',
        async:true,
        data:{action:action, team:team, loginid:loginid},
        beforeSend: function(){
            $('#company_view').html('<br/><br/><br/><br/><br/><br/><center><div class=\"loader-box\"><div class=\"loader-2\"></div></div><br/><b>輸入中</b></center></p>');
        },
    })
    .done(function(response){
        $('#company_view').html(response);
        refresh_table(action);
    })
    .fail(function(xhr, status, error){
        $('#company_view').html(xhr.responseText);
        //alert(xhr.responseText);
    })
    var selectTab
    $('[data-toggle="tabajax"]').click(function(e) {
        var $this = $(this)
        selectTab = $this.attr('action');

        var	pagetype = $this.attr('href'),
            targ = $this.attr('data-target'),
            action = $this.attr('action');
            usage = $this.attr('usage');
            propertyid = $this.attr('propertyid');
            propertyid_list = $this.attr('propertyid_list');

            if (action == "property_view") {
                if ($('#property_view').html() != "") {
                    $this.tab('show');
                    return false;
                }
            }
            if (propertyid_list == "") {
                if (propertyid == "" || propertyid == 0) {
                    if ((action != "property_edit") && (action != "usage_view")) {
                        alert("請先選擇要查看的物業再繼續！")
                        return false;
                    }
                }
            }

            lock = $this.attr('lock');
            if (lock == 1) {
                alert("\u26A0 沒有存取此頁面的存取權限！欲了解更多信息，請聯絡系統管理員。");
                return false;
            }

            $.ajax({
                url:'{% url 'ownerMain_response' %}',
                type:'POST',
                async:true,
                data:{action:action, usage:usage, propertyid:propertyid, propertyid_list:propertyid_list},
                beforeSend: function(){
                    // Display the loading message with the current time
                    var startTime = new Date().getTime();
                    $('#'+action).html('<br/><br/><br/><br/><br/><center><div class=\"loader-box\"><div class=\"loader-2\"></div></div><br/><span id="loadingTime"></span><br/><br/><br/><br/><br/></center></p>');
                    loadingInterval = setInterval(function() {
                      // Update the loading time every second
                      var elapsedTime = Math.floor((new Date().getTime() - startTime) / 1000);
                      $('#loadingTime').html('讀取時間: ' + elapsedTime + ' 秒');
                    }, 1000);
                },
            })
            .done(function(response){
                // Calculate the loading time and append it to the response message
                clearInterval(loadingInterval); // Clear the loading interval
                $('#'+action).html(response);
                $("#cboUsage1").val(usage);
                var typeElement = document.getElementById('cboUsage1');
                if (usage == "")
                    typeElement.disabled = false;
                else
                    typeElement.disabled = true;
                //refresh_table(action);
                if (action == "usage_view") $("div.toolbar").html('<b><font size=3>用戶列表</font></b>');
                if (action == "property_view") $("div.toolbar").html('<b><font size=3>物業列表</font></b>');
                if (action == "request_review") $("div.toolbar").html('<b><font size=3>審批申請列表</font></b>&nbsp;&nbsp;&nbsp;');
            })
            .fail(function(xhr, status, error){
                clearInterval(loadingInterval); // Clear the loading interval
                $('#errormessage').html(xhr.responseText);
            })
            //$(loadurl).html(loadurl);
            $this.tab('show');
        return false;
    });

    $(document).on("click", "#reset_button", function(){
        var propertyEditElement = document.getElementById('property_edits'); // Get the element with ID "property_edit"
        propertyEditElement.setAttribute('propertyid', '');
        var propertyElement = document.getElementById('property_infos'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', '');
        var propertyElement = document.getElementById('property_oddsheets'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', '');
        var propertyElement = document.getElementById('property_offers'); // Get the element with ID "property_edit"
        propertyElement.setAttribute('propertyid', '');
        //var propertyElement = document.getElementById('property_contacts'); // Get the element with ID "property_edit"
        //propertyElement.setAttribute('propertyid', '');
        //var propertyElement = document.getElementById('property_follows'); // Get the element with ID "property_edit"
        //propertyElement.setAttribute('propertyid', '');


        $('a[href="#property_edit"]').trigger('click');
    })

    $(document).on("click", "#save_button, #edit_button, #delete_button", function(){
        //Disabling the Button while data is being saved in Server
        //$(this).attr("disabled", "disabled")
        //$(this).text("Confirming...")
        //console.log("SAVE")
        action = $(this).attr("action");
        propertyid = $("#propertyid2").val();
        propertyno = $("#propertyno").val();
        propertyname = $("#propertyname").val();
        usage = $("#usage").val();

        district = $("#district").val();
        subdistrict = $("#subdistrict").val();
        street = $("#street").val();
        streetno = $("#streetno").val();
        building = $("#building").val();
        floorzone = $("#floorzone").val();
        floor = $("#floor").val();
        unit = $("#unit").val();

        grossarea = $("#grossarea").val();
        netarea = $("#netarea").val();
        offertype = $("#offertype").val();
        possession = $("#possession").val();
        sellingprice = $("#sellingprice").val();
        unitprice = $("#unitprice").val();
        rent = $("#rent").val();
        unitrent = $("#unitrent").val();
        managementfee = $("#managementfee").val();
        unitmanagementfee = $("#unitmanagementfee").val();
        rates = $("#rates").val();
        unitrates = $("#unitrates").val();
        yield_field = $("#yield_field").val();
        atticarea = $("#atticarea").val();
        platformarea = $("#platformarea").val();
        rooftoparea = $("#rooftoparea").val();
        gardenarea = $("#gardenarea").val();
        tenant = $("#tenant").val();
        currentrent = $("#currentrent").val();
        rentalperiod = $("#rentalperiod").val();
        rentalstartdate = $("#rentalstartdate").val();
        formerowner = $("#formerowner").val();
        finalprice = $("#finalprice").val();
        transactiondate = $("#transactiondate").val();

        if (propertyno == "") {
            alert("請輸入物業編號");
            $("#propertyno").focus();
            return false
        }
        if (district == "") {
            alert("請選擇地區");
            $("#district").focus();
            return false
        }
        if (subdistrict == "") {
            alert("請輸入分區");
            $("#subdistrict").focus();
            return false
        }
        if (street == "") {
            alert("請輸入街道");
            $("#street").focus();
            return false
        }

        if (offertype != "封盤") {
            if ((sellingprice != "") && (rent != "")) {
                if (offertype != "租售") {
                    alert("盤類自動由"+offertype+"轉為租售，敬請留意！");
                    $("#offertype").val("租售")
                    offertype = "租售";
                }
            }

            if ((sellingprice != "") && (rent == "")) {
                if (offertype != "放售") {
                    alert("盤類自動由"+offertype+"轉為放售，敬請留意！");
                    $("#offertype").val("放售")
                    offertype = "放售";
                }
            }


            if ((sellingprice == "") && (rent != "")) {
                if (offertype != "放租") {
                    alert("盤類自動由"+offertype+"轉為放租，敬請留意！");
                    $("#offertype").val("放租")
                    offertype = "放租";
                }
            }
        }

        if (propertyname == "" || propertyname == "None") {
            propertyname = "";
            if (district != "") propertyname += district;
            if (subdistrict != "") propertyname += subdistrict;
            if (street != "") propertyname += street;
            if (streetno != "") propertyname += streetno + "號";
            if (building != "") propertyname += building;
            if (floor != "") propertyname += floor + "樓";
            if (unit != "") propertyname += unit + "室";
            $("#propertyname").val(propertyname);
        }
        if (action == 'add') {
            if (!(window.confirm("新增物業資料，你確定嗎？"))) {
                return false;
            }
        } else {
            if (action == 'edit') {
                if (!(window.confirm("更改物業資料，你確定嗎？"))) {
                    return false;
                }
            } else {
                if (!(window.confirm("這些項目將永久刪除且無法恢復，你確定嗎？"))) {
                    return false;
                }
            }
        }

        // Saving Data into Database
        //alert('|action:' + action + '|propertyno:' + propertyno + '|propertyname:' + propertyname + '|usage:' + usage + '|district:' + district + '|subdistrict:' + subdistrict + '|street:' + street + '|streetno:' + streetno + '|building:' + building + '|floor:' + floor + '|unit:' + unit + '|offertype:' + offertype + '|possession:' + possession + '|grossarea:' + grossarea + '|netarea:' + netarea + '|sellingprice:' + sellingprice + '|unitprice:' + unitprice + '|rent:' + rent + '|unitrent:' + unitrent + '|managementfee:' + managementfee + '|unitmanagementfee:' + unitmanagementfee + '|rates:' + rates + '|unitrates:' + unitrates)
        $.ajax({
            url:'{% url 'property_save' %}',
            type:'POST',
            data:{action:action, propertyid:propertyid, propertyno:propertyno, propertyname:propertyname, usage:usage, district:district, subdistrict:subdistrict, street:street, streetno:streetno, building:building, floorzone:floorzone, floor:floor, unit:unit, offertype:offertype, possession:possession, grossarea:grossarea, netarea:netarea, atticarea:atticarea, platformarea:platformarea, rooftoparea:rooftoparea, gardenarea:gardenarea, sellingprice:sellingprice, unitprice:unitprice, rent:rent, unitrent:unitrent, managementfee:managementfee, unitmanagementfee:unitmanagementfee, rates:rates, unitrates:unitrates, yield_field:yield_field, tenant:tenant, currentrent:currentrent, rentalperiod:rentalperiod, rentalstartdate:rentalstartdate, formerowner:formerowner, finalprice:finalprice, transactiondate:transactiondate },
        })

        .done(function(response){
            //alert(response)
            if (response == "Success") {
                var messagetype = "success"
                if (action == "add") messagetext = "物業已成功加入"
                if (action == "edit") messagetext = propertyno+"物業已成功更新"
                if (action == "delete") messagetext = propertyno+"物業已成功刪除"
            } else {
                var messagetype = "danger"
                if (action == "add") messagetext = "物業加入失敗，請重新再試！\n"+response
                if (action == "edit") messagetext = propertyno+"物業更新失敗，請重新再試！\n"+response
                if (action == "delete") messagetext = propertyno+"物業刪除失敗，請重新再試！\n"+response
            }
            $.notify({
                message: messagetext
                },{
                    type: messagetype,
                    allow_dismiss: true,
                    positon: 'top right',
                    offset: 20,
                    spacing: 10,
                    z_index: 1031,
            });
            if (action == "edit") $('a[href="#property_edit"]').trigger('click');
            //if (action == "delete") $('a[href="#property_view"]').trigger('click');
        })

        .fail(function(xhr, status, error){
            // alert the error if any error occured
            alert(xhr.responseText);
            $("#editTable").html(xhr.responseText);
        })
    })

    $(document).on("click", "#edit_info_button", function(){
        //Disabling the Button while data is being saved in Server
        //$(this).attr("disabled", "disabled")
        //$(this).text("Confirming...")
        //console.log("SAVE")
        action = $(this).attr("action");
        propertyid = $("#propertyid").val();
        propertyno = $("#propertyno").val();

        availability = $("#availability").val();
        views = $("#views").val();
        remarks = $("#remarks").val();

        if (action == 'edit_info') {
            if (!(window.confirm("更改狀況資料，你確定嗎？"))) {
                return false;
            }
        }

        // Saving Data into Database
        //alert('|action:' + action + '|propertyno:' + propertyno + '|propertyname:' + propertyname + '|usage:' + usage + '|district:' + district + '|subdistrict:' + subdistrict + '|street:' + street + '|streetno:' + streetno + '|building:' + building + '|floor:' + floor + '|unit:' + unit + '|offertype:' + offertype + '|possession:' + possession + '|grossarea:' + grossarea + '|netarea:' + netarea + '|sellingprice:' + sellingprice + '|unitprice:' + unitprice + '|rent:' + rent + '|unitrent:' + unitrent + '|managementfee:' + managementfee + '|rates:' + rates)
        $.ajax({
            url:'{% url 'property_save' %}',
            type:'POST',
            data:{action:action, propertyid:propertyid, availability:availability, views:views, remarks:remarks},
        })

        .done(function(response){
            if (action == "edit_info") messagetext = propertyno+"狀況資料已成功更新"
            $.notify({
                message: messagetext
                },{
                    type: 'success',
                    allow_dismiss: true,
                    positon: 'top right',
                    offset: 20,
                    spacing: 10,
                    z_index: 1031,
            });
        })

        .fail(function(xhr, status, error){
            // alert the error if any error occured
            //alert(xhr.responseText);
            $("#editTable").html(xhr.responseText);
        })
    })
    $(document).on("click", ".availability-option", function(){
        var optionText = $(this).text();
        $("#availability").val(optionText);
    });
    $(document).on("click", ".views-option", function(){
        var optionText = $(this).text();
        $("#views").val(optionText);
    });

    $(document).on("keyup", "#sellingprice", function(){
        var sellingprice = $(this).val();
        var usage = $("#usage").val();
        if (usage != "住宅")
            var property_area = $("#grossarea").val();
        else
            var property_area = $("#netarea").val();
        var unitprice = sellingprice / property_area;
        $("#unitprice").val(unitprice.toFixed(2));
        if (unitprice.toFixed(2) == 0.00) $("#unitprice").val("");

        var currentrent = $("#currentrent").val();

        if ((sellingprice != "") && (currentrent != "")){
            var yield_field = currentrent / sellingprice;
            yield_field = yield_field * 100
        } else {
            var yield_field = "";
        }
        $("#yield_field").val(yield_field.toFixed(2));
        if (yield_field.toFixed(2) == 0.00) $("#yield_field").val("");
    })
    $(document).on("keyup", "#unitprice", function(){
        var unitprice = $(this).val();
        var usage = $("#usage").val();
        if (usage != "住宅")
            var property_area = $("#grossarea").val();
        else
            var property_area = $("#netarea").val();
        $("#sellingprice").val(unitprice * property_area);
        if ($("#sellingprice").val() == 0) $("#sellingprice").val("");
    })
    $(document).on("keyup", "#rent", function(){
        var rent = $(this).val();
        if (usage != "住宅")
            var property_area = $("#grossarea").val();
        else
            var property_area = $("#netarea").val();
        var unitrent = rent / property_area;
        $("#unitrent").val(unitrent.toFixed(2));
        if (unitrent.toFixed(2) == 0.00) $("#unitrent").val("");
    })
    $(document).on("keyup", "#unitrent", function(){
        var unitrent = $(this).val();
        if (usage != "住宅")
            var property_area = $("#grossarea").val();
        else
            var property_area = $("#netarea").val();
        $("#rent").val(unitrent * property_area);
        if ($("#rent").val() == 0) $("#rent").val("");
    })
    $(document).on("keyup", "#managementfee", function(){
        var managementfee = $(this).val();
        if (usage != "住宅")
            var property_area = $("#grossarea").val();
        else
            var property_area = $("#netarea").val();
        var unitmanagementfee = managementfee / property_area;
        $("#unitmanagementfee").val(unitmanagementfee.toFixed(2));
        if (unitmanagementfee.toFixed(2) == 0.00) $("#unitmanagementfee").val("");
    })
    $(document).on("keyup", "#unitmanagementfee", function(){
        var unitmanagementfee = $(this).val();
        if (usage != "住宅")
            var property_area = $("#grossarea").val();
        else
            var property_area = $("#netarea").val();
        $("#managementfee").val(unitmanagementfee * property_area);
        if ($("#managementfee").val() == 0) $("#managementfee").val("");
    })
    $(document).on("keyup", "#rates", function(){
        var rates = $(this).val();
        if (usage != "住宅")
            var property_area = $("#grossarea").val();
        else
            var property_area = $("#netarea").val();
        var unitrates = rates / property_area;
        $("#unitrates").val(unitrates.toFixed(2));
        if (unitrates.toFixed(2) == 0.00) $("#unitrates").val("");
    })
    $(document).on("keyup", "#unitrates", function(){
        var unitrates = $(this).val();
        if (usage != "住宅")
            var property_area = $("#grossarea").val();
        else
            var property_area = $("#netarea").val();
        $("#rates").val(unitrates * property_area);
        if ($("#rates").val() == 0) $("#rates").val("");
    })
    $(document).on("keyup", "#currentrent", function(){
        var currentrent = $(this).val();
        var sellingprice = $("#sellingprice").val();

        if (sellingprice != "") {
            var yield_field = currentrent / sellingprice;
            yield_field = yield_field * 100
        } else {
            var yield_field = "";
        }
        $("#yield_field").val(yield_field.toFixed(2));
        if (yield_field.toFixed(2) == 0.00) $("#yield_field").val("");
    })

    $("#searchinput").on("keyup", function() {
        var oTable = $('#contentTable').dataTable();
        oTable.fnFilter($(this).val());
    });
    {% if user_propertyid is not None and user_propertyid != "" %}
        $('a[href="#property_edit"]').trigger('click');
    {% endif %}


{% endif %}
</script>
{% if action == "property_edit" %}
    <script src="{% static 'Koho/assets/js/owlcarousel/owl-custom.js' %}"></script>
{% endif %}
{% endblock custom_js %}